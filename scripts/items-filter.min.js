(()=>{"use strict";function e(e){return document.querySelector(e)}function t(e){return document.querySelectorAll(e)}var n,a="undefined"==typeof document?void 0:document,r=!!a&&"content"in a.createElement("template"),i=!!a&&a.createRange&&"createContextualFragment"in a.createRange();function o(e,t){var n,a,r=e.nodeName,i=t.nodeName;return r===i||(n=r.charCodeAt(0),a=i.charCodeAt(0),n<=90&&a>=97?r===i.toUpperCase():a<=90&&n>=97&&i===r.toUpperCase())}function d(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var l={OPTION:function(e,t){var n=e.parentNode;if(n){var a=n.nodeName.toUpperCase();"OPTGROUP"===a&&(a=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==a||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}d(e,t,"selected")},INPUT:function(e,t){d(e,t,"checked"),d(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var a=e.firstChild;if(a){var r=a.nodeValue;if(r==n||!n&&r==e.placeholder)return;a.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,a,r=-1,i=0,o=e.firstChild;o;)if("OPTGROUP"===(a=o.nodeName&&o.nodeName.toUpperCase()))o=(n=o).firstChild;else{if("OPTION"===a){if(o.hasAttribute("selected")){r=i;break}i++}!(o=o.nextSibling)&&n&&(o=n.nextSibling,n=null)}e.selectedIndex=r}}};function s(){}function c(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}const u=function(e,t,d){if(d||(d={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName||"BODY"===e.nodeName){var u=t;(t=a.createElement("html")).innerHTML=u}else f=(f=t).trim(),t=r?function(e){var t=a.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(f):i?function(e){return n||(n=a.createRange()).selectNode(a.body),n.createContextualFragment(e).childNodes[0]}(f):function(e){var t=a.createElement("body");return t.innerHTML=e,t.childNodes[0]}(f);else 11===t.nodeType&&(t=t.firstElementChild);var f,p=d.getNodeKey||c,m=d.onBeforeNodeAdded||s,h=d.onNodeAdded||s,v=d.onBeforeElUpdated||s,g=d.onElUpdated||s,N=d.onBeforeNodeDiscarded||s,y=d.onNodeDiscarded||s,b=d.onBeforeElChildrenUpdated||s,E=d.skipFromChildren||s,C=d.addChild||function(e,t){return e.appendChild(t)},A=!0===d.childrenOnly,T=Object.create(null),S=[];function L(e){S.push(e)}function x(e,t){if(1===e.nodeType)for(var n=e.firstChild;n;){var a=void 0;t&&(a=p(n))?L(a):(y(n),n.firstChild&&x(n,t)),n=n.nextSibling}}function w(e,t,n){!1!==N(e)&&(t&&t.removeChild(e),y(e),x(e,n))}function U(e){h(e);for(var t=e.firstChild;t;){var n=t.nextSibling,a=p(t);if(a){var r=T[a];r&&o(t,r)?(t.parentNode.replaceChild(r,t),O(r,t)):U(t)}else U(t);t=n}}function O(e,t,n){var r=p(t);if(r&&delete T[r],!n){if(!1===v(e,t))return;if(function(e,t){var n,a,r,i,o=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var d=o.length-1;d>=0;d--)a=(n=o[d]).name,r=n.namespaceURI,i=n.value,r?(a=n.localName||a,e.getAttributeNS(r,a)!==i&&("xmlns"===n.prefix&&(a=n.name),e.setAttributeNS(r,a,i))):e.getAttribute(a)!==i&&e.setAttribute(a,i);for(var l=e.attributes,s=l.length-1;s>=0;s--)a=(n=l[s]).name,(r=n.namespaceURI)?(a=n.localName||a,t.hasAttributeNS(r,a)||e.removeAttributeNS(r,a)):t.hasAttribute(a)||e.removeAttribute(a)}}(e,t),g(e),!1===b(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,r,i,d,s,c=E(e,t),u=t.firstChild,f=e.firstChild;e:for(;u;){for(d=u.nextSibling,n=p(u);!c&&f;){if(i=f.nextSibling,u.isSameNode&&u.isSameNode(f)){u=d,f=i;continue e}r=p(f);var h=f.nodeType,v=void 0;if(h===u.nodeType&&(1===h?(n?n!==r&&((s=T[n])?i===s?v=!1:(e.insertBefore(s,f),r?L(r):w(f,e,!0),r=p(f=s)):v=!1):r&&(v=!1),(v=!1!==v&&o(f,u))&&O(f,u)):3!==h&&8!=h||(v=!0,f.nodeValue!==u.nodeValue&&(f.nodeValue=u.nodeValue))),v){u=d,f=i;continue e}r?L(r):w(f,e,!0),f=i}if(n&&(s=T[n])&&o(s,u))c||C(e,s),O(s,u);else{var g=m(u);!1!==g&&(g&&(u=g),u.actualize&&(u=u.actualize(e.ownerDocument||a)),C(e,u),U(u))}u=d,f=i}!function(e,t,n){for(;t;){var a=t.nextSibling;(n=p(t))?L(n):w(t,e,!0),t=a}}(e,f,r);var N=l[e.nodeName];N&&N(e,t)}(e,t):l.TEXTAREA(e,t)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var n=t.firstChild;n;){var a=p(n);a&&(T[a]=n),e(n),n=n.nextSibling}}(e);var D,I,R=e,k=R.nodeType,M=t.nodeType;if(!A)if(1===k)1===M?o(e,t)||(y(e),R=function(e,t){for(var n=e.firstChild;n;){var a=n.nextSibling;t.appendChild(n),n=a}return t}(e,(D=t.nodeName,(I=t.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==I?a.createElementNS(I,D):a.createElement(D)))):R=t;else if(3===k||8===k){if(M===k)return R.nodeValue!==t.nodeValue&&(R.nodeValue=t.nodeValue),R;R=t}if(R===t)y(e);else{if(t.isSameNode&&t.isSameNode(R))return;if(O(R,t,A),S)for(var P=0,V=S.length;P<V;P++){var q=T[S[P]];q&&w(q,q.parentNode,!1)}}return!A&&R!==e&&e.parentNode&&(R.actualize&&(R=R.actualize(e.ownerDocument||a)),e.parentNode.replaceChild(R,e)),R};async function f(e,t=null){const n={method:"get"};return t&&(n.method="post",n.body=t),fetch(e,n).then((e=>e.json())).then((e=>e.data))}const p=e("[data-role=filter-form]"),m=t("[name=affichage]"),h=e("[data-role=range-filter]"),v=t("[data-role=origin-selector]"),g=e("[name=keyword]");let N;function y(){const e=t("[data-role=spells-wrapper] .liste"),n=[];v.length?v.forEach((e=>{e.checked&&n.push(e.value)})):n.push("RdB");const a=h.value.split("-"),r=parseInt(a[0]),i=parseInt(a[1]||r);r>i&&([r,i]=[i,r]);const o=g?g.value:"";e.forEach((e=>{const t=A(e.querySelector("summary div:first-of-type").textContent,o)||o.length<=2;e.dataset.nivMin>i||e.dataset.nivMax<r||!n.includes(e.dataset.origin)||!t?e.classList.add("hidden"):e.classList.remove("hidden")})),C()}function b(){if(!g)return;const e=t("[data-role=skills-wrapper] .liste"),n=g.value;e.forEach((e=>{A(e.querySelector("summary").textContent,n)||n.length<=2?e.classList.remove("hidden"):e.classList.add("hidden")})),C()}function E(){if(!g)return;const e=t("[data-role=avdesavs-wrapper] .liste"),n=g.value;e.forEach((e=>{A(e.querySelector("summary").textContent,n)||n.length<=2?e.classList.remove("hidden"):e.classList.add("hidden")})),C()}function C(){t(":is([data-role=avdesavs-wrapper], [data-role=skills-wrapper], [data-role=spells-wrapper]) details:not(.liste)").forEach((e=>{e.querySelectorAll(".liste:not(.hidden)").length?e.classList.remove("hidden"):e.classList.add("hidden")}))}function A(e,t){const n=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");return e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").includes(n)}function T(){t("[data-details]").forEach((e=>{e.closest("details.liste").addEventListener("click",(async e=>{const t=e.target.closest("details.liste").querySelector("[data-details]"),n=parseInt(t.dataset.id);if("spell"===t.dataset.type){const e=await f("/api/get-spell?id="+n);t.innerHTML=e.fullDescription}if("avdesav"===t.dataset.type){const e=await f("/api/get-avdesav?id="+n);t.innerHTML=e.description}}))}))}p.addEventListener("submit",(e=>e.preventDefault())),T(),m.forEach((e=>{e.addEventListener("change",(t=>{const n=new FormData;n.append("affichage",e.value),fetch(p.action,{method:"POST",body:n}).then((e=>e.text())).then((e=>{var t,n;t="main",n=e,new Promise(((e,a)=>{try{const a=(new DOMParser).parseFromString(n,"text/html").querySelector(t),r=document.querySelector(t);u(r,a,{onBeforeElUpdated:function(e,t){if("DETAILS"===e.tagName&&e.id===t.id&&(t.open=e.open),"ignore"===e.dataset.morphdom)return!1}}),e("DOM updated successfully")}catch(e){a(e)}})),y(),b(),E(),T()}))}))})),h.addEventListener("keyup",(e=>{N&&clearTimeout(N),N=setTimeout(y,500)})),v.forEach((e=>{e.addEventListener("change",(e=>{y()}))})),g&&g.addEventListener("keyup",(e=>{y(),b(),E()}))})();