(()=>{"use strict";function e(e){return document.querySelector(e)}function t(t,s){const a=function(e,t=[]){const s=document.createElement(e);return t.forEach((e=>s.classList.add(e))),s}("div",["alert",`alert-${(".alert",document.querySelectorAll(".alert")).length+1}`]);a.innerHTML=t,a.classList.add(s);const n=e("#page-wrapper");document.body.insertBefore(a,n),setTimeout((()=>a.classList.add("active")),100),setTimeout((()=>a.classList.remove("active")),2e3),setTimeout((()=>a.remove()),2100)}const s=e("#pwd-change-form"),a=e("#pwd0"),n=e("#pwd1"),o=e("#pwd2");let d=!1,r=!1;n.addEventListener("keyup",(()=>{!function(e){const t=/\d+/.test(e),s=e.length>=8,a=/\W+/.test(e),n=/\s+/.test(e),o=/[A-Z]/.test(e),d=/[a-z]/.test(e);return t&&s&&a&&!n&&o&&d}(n.value)?(d=!1,n.setCustomValidity("Mot de passe faible")):(d=!0,n.setCustomValidity(""))})),o.addEventListener("keyup",(()=>{n.value===o.value?(o.setCustomValidity(""),r=!0):(o.setCustomValidity("Les mots de passe ne correspondent pas"),r=!1)})),s.addEventListener("submit",(e=>{e.preventDefault(),d&&r?fetch("/submit/change-password",{method:"post",body:new FormData(s)}).then((e=>e.json())).then((e=>t(e.msg,e.error?"invalid":"valid"))).then((()=>{a.value="",n.value="",o.value=""})):t(r?"Votre nouveau mot de passe n’est pas assez fort":"Les mots de passe donnés sont différents !","invalid")}));const i=e("form[data-role=user-options]"),u=new BroadcastChannel("display-options");i.addEventListener("change",(e=>{"mode"===e.target.name?(document.documentElement.dataset.mode=e.target.value,document.documentElement.dataset.preset=e.target.value):"style"===e.target.name&&("compact"===e.target.value?document.body.classList.add("compact"):document.body.classList.remove("compact"));const s=new FormData;s.append("option",e.target.name),s.append("value",e.target.value),fetch("/submit/set-user-option",{method:"post",body:s}).then((()=>t("Préférences modifiées","valid"))).then((()=>u.postMessage({option:e.target.name,value:e.target.value})))}))})();