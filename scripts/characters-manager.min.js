(()=>{"use strict";var __webpack_modules__={771:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function qs(e){return document.querySelector(e)}function qsa(e){return document.querySelectorAll(e)}function ce(e,t=[]){const n=document.createElement(e);return t.forEach((e=>n.classList.add(e))),n}function checkPasswordStrength(e){const t=/\d+/.test(e),n=e.length>=8,a=/\W+/.test(e),r=/\s+/.test(e),o=/[A-Z]/.test(e),i=/[a-z]/.test(e);return t&&n&&a&&!r&&o&&i}function calculate(str){if(null===str)return"";let result;str=str.replace(/[+-]+$/g,""),str=str.replace(/[^-\(\)\d/\*+\.]/g,"");try{result=eval(str)}catch(e){result=""}return result=void 0===result?"":result,result}function int(e){return isNaN(parseInt(e))?0:parseInt(e)}function coarseRound(e){let t=!1;return e<0&&(e*=-1,t=!0),e=e<50?Math.round(e):e<200?5*Math.round(e/5):e<500?10*Math.round(e/10):e<2e3?50*Math.round(e/50):100*Math.round(e/100),t&&(e*=-1),e}function trimModifier(e){return(e=e.replace(/\([+-]\d+\)$/g,"")).trimEnd()}function explicitSign(e){return e>0?`+${e}`:`${e}`}__webpack_require__.d(__webpack_exports__,{Kf:()=>calculate,e$:()=>int,qs:()=>qs,uJ:()=>qsa})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{var e=__webpack_require__(771);const t="site-jdr"===window.location.hostname?"ws://127.0.0.1:1337":"wss://web-chat.pichegru.net:443";class n{constructor(e,t,n,a,r=[],o=null){this.sender=parseInt(e),this.key=t,this.type=n,this.timestamp=Date.now(),this.content=a,this.recipients=r,this.label=o}stringify(){return JSON.stringify(this)}}var a,r="undefined"==typeof document?void 0:document,o=!!r&&"content"in r.createElement("template"),i=!!r&&r.createRange&&"createContextualFragment"in r.createRange();function s(e,t){var n,a,r=e.nodeName,o=t.nodeName;return r===o||(n=r.charCodeAt(0),a=o.charCodeAt(0),n<=90&&a>=97?r===o.toUpperCase():a<=90&&n>=97&&o===r.toUpperCase())}function c(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var d={OPTION:function(e,t){var n=e.parentNode;if(n){var a=n.nodeName.toUpperCase();"OPTGROUP"===a&&(a=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==a||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}c(e,t,"selected")},INPUT:function(e,t){c(e,t,"checked"),c(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var a=e.firstChild;if(a){var r=a.nodeValue;if(r==n||!n&&r==e.placeholder)return;a.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,a,r=-1,o=0,i=e.firstChild;i;)if("OPTGROUP"===(a=i.nodeName&&i.nodeName.toUpperCase()))i=(n=i).firstChild;else{if("OPTION"===a){if(i.hasAttribute("selected")){r=o;break}o++}!(i=i.nextSibling)&&n&&(i=n.nextSibling,n=null)}e.selectedIndex=r}}};function l(){}function u(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}const p=function(e,t,n){if(n||(n={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName||"BODY"===e.nodeName){var c=t;(t=r.createElement("html")).innerHTML=c}else p=(p=t).trim(),t=o?function(e){var t=r.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(p):i?function(e){return a||(a=r.createRange()).selectNode(r.body),a.createContextualFragment(e).childNodes[0]}(p):function(e){var t=r.createElement("body");return t.innerHTML=e,t.childNodes[0]}(p);else 11===t.nodeType&&(t=t.firstElementChild);var p,f=n.getNodeKey||u,h=n.onBeforeNodeAdded||l,m=n.onNodeAdded||l,v=n.onBeforeElUpdated||l,_=n.onElUpdated||l,b=n.onBeforeNodeDiscarded||l,g=n.onNodeDiscarded||l,y=n.onBeforeElChildrenUpdated||l,w=n.skipFromChildren||l,E=n.addChild||function(e,t){return e.appendChild(t)},N=!0===n.childrenOnly,S=Object.create(null),A=[];function q(e){A.push(e)}function x(e,t){if(1===e.nodeType)for(var n=e.firstChild;n;){var a=void 0;t&&(a=f(n))?q(a):(g(n),n.firstChild&&x(n,t)),n=n.nextSibling}}function T(e,t,n){!1!==b(e)&&(t&&t.removeChild(e),g(e),x(e,n))}function C(e){m(e);for(var t=e.firstChild;t;){var n=t.nextSibling,a=f(t);if(a){var r=S[a];r&&s(t,r)?(t.parentNode.replaceChild(r,t),$(r,t)):C(t)}else C(t);t=n}}function $(e,t,n){var a=f(t);if(a&&delete S[a],!n){if(!1===v(e,t))return;if(function(e,t){var n,a,r,o,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var s=i.length-1;s>=0;s--)a=(n=i[s]).name,r=n.namespaceURI,o=n.value,r?(a=n.localName||a,e.getAttributeNS(r,a)!==o&&("xmlns"===n.prefix&&(a=n.name),e.setAttributeNS(r,a,o))):e.getAttribute(a)!==o&&e.setAttribute(a,o);for(var c=e.attributes,d=c.length-1;d>=0;d--)a=(n=c[d]).name,(r=n.namespaceURI)?(a=n.localName||a,t.hasAttributeNS(r,a)||e.removeAttributeNS(r,a)):t.hasAttribute(a)||e.removeAttribute(a)}}(e,t),_(e),!1===y(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,a,o,i,c,l=w(e,t),u=t.firstChild,p=e.firstChild;e:for(;u;){for(i=u.nextSibling,n=f(u);!l&&p;){if(o=p.nextSibling,u.isSameNode&&u.isSameNode(p)){u=i,p=o;continue e}a=f(p);var m=p.nodeType,v=void 0;if(m===u.nodeType&&(1===m?(n?n!==a&&((c=S[n])?o===c?v=!1:(e.insertBefore(c,p),a?q(a):T(p,e,!0),a=f(p=c)):v=!1):a&&(v=!1),(v=!1!==v&&s(p,u))&&$(p,u)):3!==m&&8!=m||(v=!0,p.nodeValue!==u.nodeValue&&(p.nodeValue=u.nodeValue))),v){u=i,p=o;continue e}a?q(a):T(p,e,!0),p=o}if(n&&(c=S[n])&&s(c,u))l||E(e,c),$(c,u);else{var _=h(u);!1!==_&&(_&&(u=_),u.actualize&&(u=u.actualize(e.ownerDocument||r)),E(e,u),C(u))}u=i,p=o}!function(e,t,n){for(;t;){var a=t.nextSibling;(n=f(t))?q(n):T(t,e,!0),t=a}}(e,p,a);var b=d[e.nodeName];b&&b(e,t)}(e,t):d.TEXTAREA(e,t)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var n=t.firstChild;n;){var a=f(n);a&&(S[a]=n),e(n),n=n.nextSibling}}(e);var k,D,L=e,I=L.nodeType,O=t.nodeType;if(!N)if(1===I)1===O?s(e,t)||(g(e),L=function(e,t){for(var n=e.firstChild;n;){var a=n.nextSibling;t.appendChild(n),n=a}return t}(e,(k=t.nodeName,(D=t.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==D?r.createElementNS(D,k):r.createElement(k)))):L=t;else if(3===I||8===I){if(O===I)return L.nodeValue!==t.nodeValue&&(L.nodeValue=t.nodeValue),L;L=t}if(L===t)g(e);else{if(t.isSameNode&&t.isSameNode(L))return;if($(L,t,N),A)for(var M=0,P=A.length;M<P;M++){var U=S[A[M]];U&&T(U,U.parentNode,!1)}}return!N&&L!==e&&e.parentNode&&(L.actualize&&(L=L.actualize(e.ownerDocument||r)),e.parentNode.replaceChild(L,e)),L};function f(e,t){return new Promise(((n,a)=>{try{const a=(new DOMParser).parseFromString(t,"text/html").querySelector(e),r=document.querySelector(e);p(r,a,{onBeforeElUpdated:function(e,t){if("DETAILS"===e.tagName&&e.id===t.id&&(t.open=e.open),"ignore"===e.dataset.morhpdom)return!1}}),n("DOM updated successfully")}catch(e){a(e)}}))}async function h(e,t=null){const n={method:"get"};return t&&(n.method="post",n.body=t),fetch(e,n).then((e=>e.json())).then((e=>e.data))}const m=(0,e.qs)("#ws-data").dataset.sessionId,v=(0,e.qs)("#ws-data").dataset.wsKey,_=(0,e.uJ)("[data-group]"),b=new WebSocket(t);function g(t){t.querySelectorAll("[data-role=pdx-cell]").forEach((t=>{t.value=(0,e.Kf)(t.value)}));let a=t.getAttribute("id");const r=new FormData(t);fetch("/submit/update-character-state",{method:"post",body:r}).then((()=>{fetch("/gestionnaire-mj").then((e=>e.text())).then((e=>{f(`#${a}`,e);const t=new n(m,v,"character-ping",parseInt(r.get("id")));b.send(t.stringify())}))}))}b.onopen=()=>{},b.onmessage=e=>{const t=JSON.parse(e.data);console.log(t),"character-ping"===t.type&&fetch("gestionnaire-mj").then((e=>e.text())).then((e=>{f(`#state-form-character-${t.content}`,e).then((()=>w(parseInt(t.content))))}))},(0,e.uJ)("[data-role=pdx-cell]").forEach((t=>{t.addEventListener("blur",(n=>{if(n.target.value){const a=(0,e.Kf)(n.target.value);t.value=a}}))})),(0,e.uJ)("[data-role=export-character]").forEach((t=>{t.addEventListener("click",(t=>{const n=t.target.dataset.id;let a=new FormData;a.append("id",n),fetch("/submit/export-character",{method:"post",body:a}).then((e=>e.text())).then((t=>{(0,e.qs)(`#confirm-export-${n}`).innerText=t}))}))})),_.forEach((e=>{"true"===localStorage.getItem(`group-${e.dataset.group}`)&&e.setAttribute("open",!0),e.addEventListener("toggle",(t=>{const n=t.target.hasAttribute("open");localStorage.setItem(`group-${e.dataset.group}`,n)}))})),(0,e.uJ)("[data-role=character-state-form]").forEach((t=>{const n=t.querySelector("[data-role=save-character]");let a=!0;t.addEventListener("submit",(e=>{e.preventDefault(),g(t)})),n.addEventListener("click",(()=>{g(t)})),t.addEventListener("change",(()=>{a&&n.classList.add("clr-invalid"),a=!0})),t.addEventListener("keydown",(e=>{e.ctrlKey&&"s"===e.key&&(e.preventDefault(),g(t),a=!1)})),t.addEventListener("click",(async t=>{const n=t.target;if(n.hasAttribute("data-details")){const t=(0,e.e$)(n.dataset.id),a=(0,e.qs)("[data-name=details]");if("avdesav"===n.dataset.type||"power"===n.dataset.type&&"avantage"===n.dataset.origin){const e=await h("/api/get-avdesav?id="+t);a.querySelector("h4").innerText=`${e.name} (${e.displayCost})`,a.querySelector("div").innerHTML=e.description}if("power"===n.dataset.type&&"sort"===n.dataset.origin){const e=await h("/api/get-spell?id="+t);a.querySelector("h4").innerText=`${e.name} (${e.readableNiv})`,a.querySelector("div").innerHTML=e.fullDescription}a.showModal(),document.activeElement.blur()}}))}));const y=(0,e.qs)("#items-form");function w(t){const n=new FormData;n.append("id",t),fetch("/api/get-character",{method:"post",body:n}).then((e=>e.json())).then((e=>e.data)).then((n=>{!function(t,n){const a=(0,e.qs)("#state-form-character-"+t).querySelector("[data-role=character-summary]"),r=(0,e.qs)("#character-details").content.cloneNode(!0);E(r,"Description",n.description),["For","Dex","Int","San","Per","Vol","Réflexes","Sang-Froid","Vitesse"].forEach((e=>{E(r,e,n.attributes[e])})),E(r,"Dégâts",n.attributes["Dégâts"].estoc+"/"+n.attributes["Dégâts"].taille);const o=[];["Avantage","Désavantage","Travers","Réputation"].forEach((e=>{const t=n.avdesav.filter((t=>t.catégorie===e&&!o.includes(t.id))),a=[];t.forEach((e=>{let t;t=e.description?`<span data-details data-type="avdesav" data-id="${e.id}">${e.nom} (${e.points})</span>`:`${e.nom} (${e.points})`,a.push(t)})),E(r,e,a.join(", "))}));const i=n.colleges.map((e=>`${e.name}–${e.score}`)),s=i.length?`<b>Collèges&nbsp;:</b> ${i.join(", ")}`:"";E(r,"Collèges",s);const c=n.powers.map((e=>`<span data-details data-type="power" data-id="${e.data.data.id}" data-origin="${e.data.specific.Type||e.data.origin}" >${e.label}</span>`)),d=c.length?`<b>Pouvoirs&nbsp;:</b> ${c.join(", ")}`:"";E(r,"Pouvoirs",d),E(r,"Encombrement",`${n.state.Encombrement.name} (${n.carried_weight}&nbsp;kg)`);const l=n.equipment[0].liste.map((e=>`<span title="${e.notes} – ${e.secret}">${e.name}</span>`));E(r,"Équipement",l.join(", ")),a.innerHTML="",a.appendChild(r)}(t,n)}))}function E(e,t,n){""===n?e.querySelector(`[data-content=${t}]`).remove():e.querySelector(`[data-content=${t}]`).innerHTML=n}y.addEventListener("submit",(e=>{e.preventDefault(),fetch("/submit/equipment-list",{method:"post",body:new FormData(y)}).then((()=>{fetch("/gestionnaire-mj").then((e=>e.text())).then((e=>{f("#items-form",e)}))}))})),_.forEach((e=>{e.addEventListener("toggle",(t=>{e.open&&e.querySelectorAll("[data-role=character-state-form]").forEach((e=>{const t=e.querySelector("[name=Statut]").value,n=parseInt(e.querySelector("[name=id]").value);["Création","Actif"].includes(t)&&w(n)}))}))}))})()})();