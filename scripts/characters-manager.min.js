(()=>{"use strict";var __webpack_modules__={771:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function qs(e){return document.querySelector(e)}function qsa(e){return document.querySelectorAll(e)}function ce(e,t=[]){let r=document.createElement(e);return t&&t.forEach((e=>{r.classList.add(e)})),r}function checkPasswordStrength(e){const t=/\d+/.test(e),r=e.length>=8,n=/\W+/.test(e),a=/\s+/.test(e),o=/[A-Z]/.test(e),i=/[a-z]/.test(e);return t&&r&&n&&!a&&o&&i}function calculate(str){if(null===str)return"";let result;str=str.replace(/[+-]+$/g,""),str=str.replace(/[^-\(\)\d/\*+\.]/g,"");try{result=eval(str)}catch(e){result=""}return result=void 0===result?"":result,result}function int(e){return isNaN(parseInt(e))?0:parseInt(e)}function coarseRound(e){let t=!1;return e<0&&(e*=-1,t=!0),e=e<50?Math.round(e):e<200?5*Math.round(e/5):e<500?10*Math.round(e/10):e<2e3?50*Math.round(e/50):100*Math.round(e/100),t&&(e*=-1),e}function trimModifier(e){return(e=e.replace(/\([+-]\d+\)$/g,"")).trimEnd()}function explicitSign(e){return e>0?`+${e}`:`${e}`}function getInnerText(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""}__webpack_require__.d(__webpack_exports__,{C0:()=>getInnerText,Kf:()=>calculate,qs:()=>qs,uJ:()=>qsa})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{var e=__webpack_require__(771);const t="site-jdr"===window.location.hostname?"ws://127.0.0.1:1337":"wss://web-chat.pichegru.net:443";class r{constructor(e,t,r,n,a=[],o=null){this.sender=parseInt(e),this.key=t,this.type=r,this.timestamp=Date.now(),this.content=n,this.recipients=a,this.label=o}stringify(){return JSON.stringify(this)}}var n,a="undefined"==typeof document?void 0:document,o=!!a&&"content"in a.createElement("template"),i=!!a&&a.createRange&&"createContextualFragment"in a.createRange();function s(e,t){var r,n,a=e.nodeName,o=t.nodeName;return a===o||(r=a.charCodeAt(0),n=o.charCodeAt(0),r<=90&&n>=97?a===o.toUpperCase():n<=90&&r>=97&&o===a.toUpperCase())}function c(e,t,r){e[r]!==t[r]&&(e[r]=t[r],e[r]?e.setAttribute(r,""):e.removeAttribute(r))}var d={OPTION:function(e,t){var r=e.parentNode;if(r){var n=r.nodeName.toUpperCase();"OPTGROUP"===n&&(n=(r=r.parentNode)&&r.nodeName.toUpperCase()),"SELECT"!==n||r.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),r.selectedIndex=-1)}c(e,t,"selected")},INPUT:function(e,t){c(e,t,"checked"),c(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var r=t.value;e.value!==r&&(e.value=r);var n=e.firstChild;if(n){var a=n.nodeValue;if(a==r||!r&&a==e.placeholder)return;n.nodeValue=r}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var r,n,a=-1,o=0,i=e.firstChild;i;)if("OPTGROUP"===(n=i.nodeName&&i.nodeName.toUpperCase()))i=(r=i).firstChild;else{if("OPTION"===n){if(i.hasAttribute("selected")){a=o;break}o++}!(i=i.nextSibling)&&r&&(i=r.nextSibling,r=null)}e.selectedIndex=a}}};function l(){}function u(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}const p=function(e,t,r){if(r||(r={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName||"BODY"===e.nodeName){var c=t;(t=a.createElement("html")).innerHTML=c}else p=(p=t).trim(),t=o?function(e){var t=a.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(p):i?function(e){return n||(n=a.createRange()).selectNode(a.body),n.createContextualFragment(e).childNodes[0]}(p):function(e){var t=a.createElement("body");return t.innerHTML=e,t.childNodes[0]}(p);else 11===t.nodeType&&(t=t.firstElementChild);var p,f=r.getNodeKey||u,m=r.onBeforeNodeAdded||l,h=r.onNodeAdded||l,_=r.onBeforeElUpdated||l,v=r.onElUpdated||l,b=r.onBeforeNodeDiscarded||l,g=r.onNodeDiscarded||l,y=r.onBeforeElChildrenUpdated||l,N=r.skipFromChildren||l,w=r.addChild||function(e,t){return e.appendChild(t)},E=!0===r.childrenOnly,S=Object.create(null),x=[];function A(e){x.push(e)}function C(e,t){if(1===e.nodeType)for(var r=e.firstChild;r;){var n=void 0;t&&(n=f(r))?A(n):(g(r),r.firstChild&&C(r,t)),r=r.nextSibling}}function q(e,t,r){!1!==b(e)&&(t&&t.removeChild(e),g(e),C(e,r))}function T(e){h(e);for(var t=e.firstChild;t;){var r=t.nextSibling,n=f(t);if(n){var a=S[n];a&&s(t,a)?(t.parentNode.replaceChild(a,t),k(a,t)):T(t)}else T(t);t=r}}function k(e,t,r){var n=f(t);if(n&&delete S[n],!r){if(!1===_(e,t))return;if(function(e,t){var r,n,a,o,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var s=i.length-1;s>=0;s--)n=(r=i[s]).name,a=r.namespaceURI,o=r.value,a?(n=r.localName||n,e.getAttributeNS(a,n)!==o&&("xmlns"===r.prefix&&(n=r.name),e.setAttributeNS(a,n,o))):e.getAttribute(n)!==o&&e.setAttribute(n,o);for(var c=e.attributes,d=c.length-1;d>=0;d--)n=(r=c[d]).name,(a=r.namespaceURI)?(n=r.localName||n,t.hasAttributeNS(a,n)||e.removeAttributeNS(a,n)):t.hasAttribute(n)||e.removeAttribute(n)}}(e,t),v(e),!1===y(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var r,n,o,i,c,l=N(e,t),u=t.firstChild,p=e.firstChild;e:for(;u;){for(i=u.nextSibling,r=f(u);!l&&p;){if(o=p.nextSibling,u.isSameNode&&u.isSameNode(p)){u=i,p=o;continue e}n=f(p);var h=p.nodeType,_=void 0;if(h===u.nodeType&&(1===h?(r?r!==n&&((c=S[r])?o===c?_=!1:(e.insertBefore(c,p),n?A(n):q(p,e,!0),n=f(p=c)):_=!1):n&&(_=!1),(_=!1!==_&&s(p,u))&&k(p,u)):3!==h&&8!=h||(_=!0,p.nodeValue!==u.nodeValue&&(p.nodeValue=u.nodeValue))),_){u=i,p=o;continue e}n?A(n):q(p,e,!0),p=o}if(r&&(c=S[r])&&s(c,u))l||w(e,c),k(c,u);else{var v=m(u);!1!==v&&(v&&(u=v),u.actualize&&(u=u.actualize(e.ownerDocument||a)),w(e,u),T(u))}u=i,p=o}!function(e,t,r){for(;t;){var n=t.nextSibling;(r=f(t))?A(r):q(t,e,!0),t=n}}(e,p,n);var b=d[e.nodeName];b&&b(e,t)}(e,t):d.TEXTAREA(e,t)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var r=t.firstChild;r;){var n=f(r);n&&(S[n]=r),e(r),r=r.nextSibling}}(e);var $,D,I=e,L=I.nodeType,O=t.nodeType;if(!E)if(1===L)1===O?s(e,t)||(g(e),I=function(e,t){for(var r=e.firstChild;r;){var n=r.nextSibling;t.appendChild(r),r=n}return t}(e,($=t.nodeName,(D=t.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==D?a.createElementNS(D,$):a.createElement($)))):I=t;else if(3===L||8===L){if(O===L)return I.nodeValue!==t.nodeValue&&(I.nodeValue=t.nodeValue),I;I=t}if(I===t)g(e);else{if(t.isSameNode&&t.isSameNode(I))return;if(k(I,t,E),x)for(var M=0,P=x.length;M<P;M++){var U=S[x[M]];U&&q(U,U.parentNode,!1)}}return!E&&I!==e&&e.parentNode&&(I.actualize&&(I=I.actualize(e.ownerDocument||a)),e.parentNode.replaceChild(I,e)),I};function f(e,t){return new Promise(((r,n)=>{try{const n=(new DOMParser).parseFromString(t,"text/html").querySelector(e),a=document.querySelector(e);p(a,n,{onBeforeElUpdated:function(e,t){if("DETAILS"===e.tagName&&e.id===t.id&&(t.open=e.open),"ignore"===e.dataset.morhpdom)return!1}}),r("DOM updated successfully")}catch(e){n(e)}}))}const m=(0,e.qs)("#ws-data").dataset.sessionId,h=(0,e.qs)("#ws-data").dataset.wsKey,_=(0,e.uJ)("[data-group]"),v=new WebSocket(t);function b(t){t.querySelectorAll("[data-role=pdx-cell]").forEach((t=>{t.value=(0,e.Kf)(t.value)}));let n=t.getAttribute("id");const a=new FormData(t);fetch("/submit/update-character-state",{method:"post",body:a}).then((()=>{fetch("/gestionnaire-mj").then((e=>e.text())).then((e=>{f(`#${n}`,e);const t=new r(m,h,"character-ping",parseInt(a.get("id")));v.send(t.stringify())}))}))}v.onopen=()=>{},v.onmessage=e=>{const t=JSON.parse(e.data);console.log(t),"character-ping"===t.type&&fetch("gestionnaire-mj").then((e=>e.text())).then((e=>{f(`#state-form-character-${t.content}`,e).then((()=>y(parseInt(t.content))))}))},(0,e.uJ)("[data-role=pdx-cell]").forEach((t=>{t.addEventListener("blur",(r=>{if(r.target.value){const n=(0,e.Kf)(r.target.value);t.value=n}}))})),(0,e.uJ)("[data-role=export-character]").forEach((t=>{t.addEventListener("click",(t=>{const r=t.target.dataset.id;let n=new FormData;n.append("id",r),fetch("/submit/export-character",{method:"post",body:n}).then((e=>e.text())).then((t=>{(0,e.qs)(`#confirm-export-${r}`).innerText=t}))}))})),_.forEach((e=>{"true"===localStorage.getItem(`group-${e.dataset.group}`)&&e.setAttribute("open",!0),e.addEventListener("click",(t=>{if("SUMMARY"===t.target.tagName){const r=!t.target.closest("details").hasAttribute("open");localStorage.setItem(`group-${e.dataset.group}`,r)}}))})),(0,e.uJ)("[data-role=character-state-form]").forEach((e=>{const t=e.querySelector("[data-role=save-character]");let r=!0;e.addEventListener("submit",(t=>{t.preventDefault(),b(e)})),t.addEventListener("click",(()=>{b(e)})),e.addEventListener("change",(()=>{r&&t.classList.add("clr-invalid"),r=!0})),e.addEventListener("keydown",(t=>{t.ctrlKey&&"s"===t.key&&(t.preventDefault(),b(e),r=!1)}))}));const g=(0,e.qs)("#items-form");function y(t){const r=new FormData;r.append("id",t),fetch("/api/get-character",{method:"post",body:r}).then((e=>e.json())).then((e=>e.data)).then((r=>{!function(t,r){const n=(0,e.qs)("#state-form-character-"+t).querySelector("[data-role=character-summary]"),a=(0,e.qs)("#character-details").content.cloneNode(!0);N(a,"Description",r.description),["For","Dex","Int","San","Per","Vol","Réflexes","Sang-Froid","Vitesse"].forEach((e=>{N(a,e,r.attributes[e])})),N(a,"Dégâts",r.attributes["Dégâts"].estoc+"/"+r.attributes["Dégâts"].taille);const o=[];["Avantage","Désavantage","Travers","Réputation"].forEach((t=>{const n=r.avdesav.filter((e=>e.catégorie===t&&!o.includes(e.id))),i=[];n.forEach((t=>{let r;r=t.description?`<span title="${(0,e.C0)(t.description)}">${t.nom} (${t.points})</span>`:`${t.nom} (${t.points})`,i.push(r)})),N(a,t,i.join(", "))}));const i=r.colleges.map((e=>`${e.name}–${e.score}`)),s=i.length?`<b>Collèges&nbsp;:</b> ${i.join(", ")}`:"";N(a,"Collèges",s);const c=r.powers.map((e=>e.nom)),d=c.length?`<b>Pouvoirs&nbsp;:</b> ${c.join(", ")}`:"";N(a,"Pouvoirs",d),N(a,"Encombrement",`${r.state.Encombrement.name} (${r.carried_weight}&nbsp;kg)`);const l=r.equipment[0].liste.map((e=>`<span title="${e.notes} – ${e.secret}">${e.name}</span>`));N(a,"Équipement",l.join(", ")),n.innerHTML="",n.appendChild(a)}(t,r)}))}function N(e,t,r){""===r?e.querySelector(`[data-content=${t}]`).remove():e.querySelector(`[data-content=${t}]`).innerHTML=r}g.addEventListener("submit",(e=>{e.preventDefault(),fetch("/submit/equipment-list",{method:"post",body:new FormData(g)}).then((()=>{fetch("/gestionnaire-mj").then((e=>e.text())).then((e=>{f("#items-form",e)}))}))})),_.forEach((e=>{e.addEventListener("toggle",(t=>{e.open&&e.querySelectorAll("[data-role=character-state-form]").forEach((e=>{const t=e.querySelector("[name=Statut]").value,r=parseInt(e.querySelector("[name=id]").value);["Création","Actif"].includes(t)&&y(r)}))}))}))})()})();