(()=>{"use strict";function e(e){return document.querySelector(e)}function t(e){return document.querySelectorAll(e)}var n,a="undefined"==typeof document?void 0:document,r=!!a&&"content"in a.createElement("template"),i=!!a&&a.createRange&&"createContextualFragment"in a.createRange();function o(e,t){var n,a,r=e.nodeName,i=t.nodeName;return r===i||(n=r.charCodeAt(0),a=i.charCodeAt(0),n<=90&&a>=97?r===i.toUpperCase():a<=90&&n>=97&&i===r.toUpperCase())}function d(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var l={OPTION:function(e,t){var n=e.parentNode;if(n){var a=n.nodeName.toUpperCase();"OPTGROUP"===a&&(a=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==a||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}d(e,t,"selected")},INPUT:function(e,t){d(e,t,"checked"),d(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var a=e.firstChild;if(a){var r=a.nodeValue;if(r==n||!n&&r==e.placeholder)return;a.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,a,r=-1,i=0,o=e.firstChild;o;)if("OPTGROUP"===(a=o.nodeName&&o.nodeName.toUpperCase()))o=(n=o).firstChild;else{if("OPTION"===a){if(o.hasAttribute("selected")){r=i;break}i++}!(o=o.nextSibling)&&n&&(o=n.nextSibling,n=null)}e.selectedIndex=r}}};function s(){}function c(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}const u=function(e,t,d){if(d||(d={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName||"BODY"===e.nodeName){var u=t;(t=a.createElement("html")).innerHTML=u}else f=(f=t).trim(),t=r?function(e){var t=a.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(f):i?function(e){return n||(n=a.createRange()).selectNode(a.body),n.createContextualFragment(e).childNodes[0]}(f):function(e){var t=a.createElement("body");return t.innerHTML=e,t.childNodes[0]}(f);else 11===t.nodeType&&(t=t.firstElementChild);var f,m=d.getNodeKey||c,p=d.onBeforeNodeAdded||s,v=d.onNodeAdded||s,h=d.onBeforeElUpdated||s,b=d.onElUpdated||s,g=d.onBeforeNodeDiscarded||s,N=d.onNodeDiscarded||s,y=d.onBeforeElChildrenUpdated||s,E=d.skipFromChildren||s,A=d.addChild||function(e,t){return e.appendChild(t)},C=!0===d.childrenOnly,S=Object.create(null),T=[];function w(e){T.push(e)}function x(e,t){if(1===e.nodeType)for(var n=e.firstChild;n;){var a=void 0;t&&(a=m(n))?w(a):(N(n),n.firstChild&&x(n,t)),n=n.nextSibling}}function L(e,t,n){!1!==g(e)&&(t&&t.removeChild(e),N(e),x(e,n))}function U(e){v(e);for(var t=e.firstChild;t;){var n=t.nextSibling,a=m(t);if(a){var r=S[a];r&&o(t,r)?(t.parentNode.replaceChild(r,t),O(r,t)):U(t)}else U(t);t=n}}function O(e,t,n){var r=m(t);if(r&&delete S[r],!n){if(!1===h(e,t))return;if(function(e,t){var n,a,r,i,o=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var d=o.length-1;d>=0;d--)a=(n=o[d]).name,r=n.namespaceURI,i=n.value,r?(a=n.localName||a,e.getAttributeNS(r,a)!==i&&("xmlns"===n.prefix&&(a=n.name),e.setAttributeNS(r,a,i))):e.getAttribute(a)!==i&&e.setAttribute(a,i);for(var l=e.attributes,s=l.length-1;s>=0;s--)a=(n=l[s]).name,(r=n.namespaceURI)?(a=n.localName||a,t.hasAttributeNS(r,a)||e.removeAttributeNS(r,a)):t.hasAttribute(a)||e.removeAttribute(a)}}(e,t),b(e),!1===y(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,r,i,d,s,c=E(e,t),u=t.firstChild,f=e.firstChild;e:for(;u;){for(d=u.nextSibling,n=m(u);!c&&f;){if(i=f.nextSibling,u.isSameNode&&u.isSameNode(f)){u=d,f=i;continue e}r=m(f);var v=f.nodeType,h=void 0;if(v===u.nodeType&&(1===v?(n?n!==r&&((s=S[n])?i===s?h=!1:(e.insertBefore(s,f),r?w(r):L(f,e,!0),r=m(f=s)):h=!1):r&&(h=!1),(h=!1!==h&&o(f,u))&&O(f,u)):3!==v&&8!=v||(h=!0,f.nodeValue!==u.nodeValue&&(f.nodeValue=u.nodeValue))),h){u=d,f=i;continue e}r?w(r):L(f,e,!0),f=i}if(n&&(s=S[n])&&o(s,u))c||A(e,s),O(s,u);else{var b=p(u);!1!==b&&(b&&(u=b),u.actualize&&(u=u.actualize(e.ownerDocument||a)),A(e,u),U(u))}u=d,f=i}!function(e,t,n){for(;t;){var a=t.nextSibling;(n=m(t))?w(n):L(t,e,!0),t=a}}(e,f,r);var g=l[e.nodeName];g&&g(e,t)}(e,t):l.TEXTAREA(e,t)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var n=t.firstChild;n;){var a=m(n);a&&(S[a]=n),e(n),n=n.nextSibling}}(e);var k,I,D=e,R=D.nodeType,V=t.nodeType;if(!C)if(1===R)1===V?o(e,t)||(N(e),D=function(e,t){for(var n=e.firstChild;n;){var a=n.nextSibling;t.appendChild(n),n=a}return t}(e,(k=t.nodeName,(I=t.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==I?a.createElementNS(I,k):a.createElement(k)))):D=t;else if(3===R||8===R){if(V===R)return D.nodeValue!==t.nodeValue&&(D.nodeValue=t.nodeValue),D;D=t}if(D===t)N(e);else{if(t.isSameNode&&t.isSameNode(D))return;if(O(D,t,C),T)for(var P=0,M=T.length;P<M;P++){var q=S[T[P]];q&&L(q,q.parentNode,!1)}}return!C&&D!==e&&e.parentNode&&(D.actualize&&(D=D.actualize(e.ownerDocument||a)),e.parentNode.replaceChild(D,e)),D},f="site-jdr"===window.location.hostname?"ws://127.0.0.1:1337":"wss://web-chat.pichegru.net:443";class m{constructor(e,t,n,a,r=[],i=null){this.sender=parseInt(e),this.key=t,this.type=n,this.timestamp=Date.now(),this.content=a,this.recipients=r,this.label=i}stringify(){return JSON.stringify(this)}}const p=e("#noyau"),v=p.dataset.sessionId,h=p.dataset.wsKey,b=e("[name=id]").value,g=e("[type=submit]"),N=new WebSocket(f);N.onopen=()=>{},N.onmessage=e=>{const t=JSON.parse(e.data);console.log(t)},e("[data-role=add-portrait]").addEventListener("change",(t=>{const n=/[^\\]+\.([\w]{3,4})$/.exec(t.target.value),a=n[1];let r=n[0];["jpg","jpeg","webp","png"].includes(a)||(r="format invalide"),e("#file").innerText=r}));const y=e("[data-role=add-quirk]"),E=e("#avdesav-wrapper");function A(){t("[data-role=close-input-modal]").forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.closest("dialog");t.querySelectorAll("input").forEach((e=>e.checked=!1)),t.close()}))}))}y.addEventListener("click",(e=>{console.log(e.target);const t=function(e,t=[]){const n=document.createElement(e);return t.forEach((e=>n.classList.add(e))),n}("div"),n=e.target.dataset.number;t.innerHTML=`\n\t\t<input hidden name="Avdesav[${n}][id]" value="0">\n\t\t<details>\n\t\t\t<summary>\n\t\t\t\t<div class="flex-s gap-½">\n\t\t\t\t\t<input type="text" name="Avdesav[${n}][nom]" class="fl-1">\n\t\t\t\t\t<input type="text" title="Coût" name="Avdesav[${n}][points]" value="-1" size="2" class="ta-center" disabled>\n\t\t\t\t</div>\n\t\t\t</summary>\n\t\t\t<div class="mt-½ fs-300">Un travers est un trait de caractère mineur ne constituant pas un désavantage. Il est possible de prendre jusqu’à 5 travers.</div>\n\t\t</details>\n\t`,E.appendChild(t),e.target.dataset.number++})),A();let C=!0;p.addEventListener("change",(()=>{C&&g.classList.add("clr-invalid"),C=!0})),p.addEventListener("keydown",(e=>{if(e.ctrlKey&&"s"===e.key){e.preventDefault();const t=new Event("submit",{bubbles:!0,cancelable:!0});p.dispatchEvent(t),C=!1}})),p.addEventListener("submit",(n=>{n.preventDefault(),t("dialog").forEach((e=>e.close())),fetch("/submit/update-character",{method:"post",body:new FormData(p)}).then((e=>e.text())).then((e=>{return t="main",n=e,new Promise(((e,a)=>{try{const a=(new DOMParser).parseFromString(n,"text/html").querySelector(t),r=document.querySelector(t);u(r,a,{onBeforeElUpdated:function(e,t){if("DETAILS"===e.tagName&&e.id===t.id&&(t.open=e.open),"ignore"===e.dataset.morhpdom)return!1}}),e("DOM updated successfully")}catch(e){a(e)}}));var t,n})).then((()=>{!function(){const n=t("[data-role=open-dialog]"),a=t("[data-role=close-modal]");n.forEach((t=>{t.addEventListener("click",(n=>{e(`[data-name=${t.dataset.dialogName}]`).showModal()}))})),a.forEach((e=>{e.addEventListener("click",(t=>{e.closest("dialog").close()}))}))}(),A();const n=new m(v,h,"character-ping",parseInt(b));N.send(n.stringify())}))}))})();