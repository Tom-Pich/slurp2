(()=>{"use strict";var __webpack_modules__={771:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function calculate(str){if(null===str)return"";let result;str=str.replace(/[+-]+$/g,""),str=str.replace(/[^-\(\)\d/\*+\.]/g,"");try{result=eval(str)}catch(e){result=""}return result=void 0===result?"":result,result}function int(e){return isNaN(parseInt(e))?0:parseInt(e)}function coarseRound(e){let t=!1;return e<0&&(e*=-1,t=!0),e=e<50?Math.round(e):e<200?5*Math.round(e/5):e<500?10*Math.round(e/10):e<2e3?50*Math.round(e/50):100*Math.round(e/100),t&&(e*=-1),e}function trimModifier(e){return(e=e.replace(/\([+-]\d+\)$/g,"")).trimEnd()}function explicitSign(e){return e>0?`+${e}`:`${e}`}__webpack_require__.d(__webpack_exports__,{Ie:()=>explicitSign,Kf:()=>calculate,e$:()=>int})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](a,a.exports,__webpack_require__),a.exports}__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{function e(e){return document.querySelector(e)}function t(e){return document.querySelectorAll(e)}function a(e,t=[]){const a=document.createElement(e);return t.forEach((e=>a.classList.add(e))),a}var n=__webpack_require__(771);function r(e){let t,a,n,r,o=0,s=/^(\d+)d(\d{0,3})([+-/*]*)([0-9\.]+)*/.exec(e);if(null===s)o=isNaN(parseInt(e))?0:parseInt(e),t=0,a="",n="+",r=o;else if(t=parseInt(s[1]),a=""!=s[2]?parseInt(s[2]):6,n=""!=s[3]?s[3]:"+",r=null!=s[4]&&""!=s[4]?parseFloat(s[4]):0,1===t&&6===a&&"-"===n&&2===r)o=Math.floor(5*Math.random());else if(1===t&&6===a&&"-"===n&&3===r)o=Math.floor(4*Math.random());else if(1===t&&6===a&&"-"===n&&4===r)o=Math.floor(3*Math.random());else if(1===t&&6===a&&"-"===n&&r<=5)o=Math.floor(2*Math.random());else{for(let e=0;e<t;e++)o+=Math.floor(Math.random()*a)+1;switch(n){case"+":o+=r;break;case"-":o-=r;break;case"*":o*=r;break;case"/":o/=r}}let l=`${t}d${6===a?"":a}${n}${r}`;return l=l.replace("+0",""),l=l.replace("-0",""),{expression:l,result:o}}async function o(){let e=new FormData;return e.append("roll",r("3d").result),await fetch("/api/localisation-table",{method:"post",body:e}).then((e=>e.json())).then((e=>e.data))}async function s(e,t,a){if(parseInt(e)&&t){let n="B."+t,r=new FormData;return r.append("for",e),r.append("notes",n),r.append("mains",a),fetch("/api/weapon-damages",{method:"post",body:r}).then((e=>e.json())).then((e=>e.data.damages.slice(2)))}}function l(e,t){const a=e-t;let n=0;18===t?n=-1:17===t?n=e>=16?0:-1:4===t?n=e<=5?0:1:3===t?n=1:a<=-10?n=-1:a>=10&&t<=7&&(n=1);let r=a>=0?"ðŸŸ¢":"ðŸ”´";return-1===n&&(r="ðŸ˜–"),1===n&&(r="ðŸ˜Ž"),{MR:a,symbol:r,critical:n}}async function c(e,t=null){const a={method:"get"};return t&&(a.method="post",a.body=t),fetch(e,a).then((e=>e.json())).then((e=>e.data))}function i(e){let t=-1;for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);if(n.startsWith(e)){const e=parseInt(n.split("-")[1],10);!isNaN(e)&&e>t&&(t=e)}}return t}class p{static mountNewOpponent(e){const t=e[e.length-1],a=(0,n.e$)(t.dataset.opponent),r=new p(t.cloneNode(!0));r.setNumber(a+1),r.mount(t),localStorage.getItem(`opponent-${r.number}`)?r.importFromLocalStorage():r.reset()}static unmountLastOpponent(e){new p(e[e.length-1]).unmount()}constructor(e){this.opponentProps=["name","category","dex","san","pain-resistance","pdvm","pdv","members"],this.opponentSelects=t("[name=opponent-selector]"),this.wrapper=e,this.number=e.dataset.opponent,this.opponentProps.forEach((e=>this[e]=this.wrapper.querySelector(`[name=${e}]`)))}importFromLocalStorage(){const e=localStorage.getItem(`opponent-${this.number}`);if(e){const t=JSON.parse(e);this.opponentProps.forEach((e=>this[e].value=t[e]))}}save(){const e={};this.opponentProps.forEach((t=>e[t]=this[t].value)),localStorage.setItem(`opponent-${this.number}`,JSON.stringify(e))}reset(){this.opponentProps.forEach((e=>this[e].value="")),this.category.value="std",localStorage.removeItem(`opponent-${this.number}`),this.updateNameInOpponentSelectors()}addToOpponentSelectors(){this.opponentSelects.forEach((e=>{const t=a("option");t.value=this.number,t.innerText=""!==this.name.value?this.name.value:`Protagoniste ${this.number}`,e.appendChild(t)}))}updateNameInOpponentSelectors(){this.opponentSelects.forEach((e=>{e.options[this.number-1].innerText=""!==this.name.value?this.name.value:`Protagoniste ${this.number}`}))}setReactivity(){this.importFromLocalStorage(),this.addToOpponentSelectors(),this.wrapper.addEventListener("keyup",(e=>{"name"===e.target.name&&""===e.target.value?this.reset():this.save()})),this.category.addEventListener("change",(e=>this.save())),this.name.addEventListener("keyup",(e=>this.updateNameInOpponentSelectors())),this.name.dispatchEvent(new Event("keyup")),this.pdvm.addEventListener("blur",(e=>{""===this.pdv.value&&(this.pdv.value=this.pdvm.value)})),this.pdv.addEventListener("blur",(e=>{this.pdv.value=(0,n.Kf)(this.pdv.value),this.save()}))}setNumber(e){this.number=e,this.wrapper.dataset.opponent=e,this.wrapper.querySelector("[data-role=opponent-number]").innerText=e}mount(e){this.wrapper.classList.add("mt-Â½"),e.parentNode.insertBefore(this.wrapper,e.nextSibling),this.setReactivity()}unmount(){localStorage.removeItem(`opponent-${this.number}`),this.wrapper.remove(),this.opponentSelects.forEach((e=>e.children[this.number-1].remove()))}}function d(e,t,a){const o={};if(o.name=e.querySelector("[data-type=skill-name]"),o.number=o.name.dataset.skillNumber,o.score=e.querySelector("[data-type=score]"),o.modifier=e.querySelector("[data-type=modif]"),localStorage.getItem(`skill-${o.number}`)){const e=JSON.parse(localStorage.getItem(`skill-${o.number}`));o.name.value=e.name,o.score.value=e.score}["keyup","change"].forEach((t=>{e.addEventListener(t,(e=>{if(""===o.name.value)o.score.value="",localStorage.removeItem(`skill-${o.number}`);else{const e={name:o.name.value,score:o.score.value};localStorage.setItem(`skill-${o.number}`,JSON.stringify(e))}}))})),e.addEventListener("submit",(e=>{if(isNaN(parseInt(o.score.value))||""===o.name.value)return;const s=(0,n.e$)(o.modifier.value),c=(0,n.e$)(o.score.value)+s,i=r("3d").result,p=l(c,i),d=0===s?"":(0,n.Ie)(s);t.value+=`${o.name.value} (${o.score.value}${d}) â†’ ${i} (MR ${p.MR} ${p.symbol})`,a("chat-roll",p.symbol)}))}window.location.hostname;class u{constructor(e,t,a,n,r=[],o=null){this.sender=parseInt(e),this.key=t,this.type=a,this.timestamp=Date.now(),this.content=n,this.recipients=r,this.label=o}stringify(){return JSON.stringify(this)}}async function m(e,t=null){const a=window.chat.inputEntry,s=window.chat.id,c=window.chat.key,i=window.chat.ws,p=/^\/(\d+,){0,10}\d+/.exec(a.value);let d=[];p&&(d=p[0].substring(1).split(","),d=d.map((e=>parseInt(e))),a.value=a.value.replace(p[0],"").trim());const m=a.value.match(/#\d{1,2}([+-]\d{1,2})?(?=\s|$)/g),v=a.value.match(/#(\d+)d(\d{0,3})([+-/*]*)([0-9\.]+)*/g),h=a.value.match(/D(\d+)d(\d{0,3})([+-/*]*)([0-9\.]+)*/g);if(m){const e=[];m.forEach((t=>{e.push(t.replace("#",""))})),e.forEach((o=>{const s=r("3d").result,c=l((0,n.Kf)(o),s),i=`[ ${o} â†’ ${s} (MR ${c.MR} ${c.symbol}) ]`;a.value=a.value.replace(`#${o}`,i),1===e.length&&null===v&&(t=c.symbol)}))}if(v){const e=[];v.forEach((t=>{e.push(t.replace("#",""))})),e.forEach((e=>{const t=`[ ${e} â†’ ${r(e).result} ]`;a.value=a.value.replace(`#${e}`,t)}))}if(h){const e=[];h.forEach((t=>{e.push(t.replace("D",""))}));const t=e.map((async e=>{const t=`[ ${e} â†’ ${r(e).result} â€“ ${(await o())[1]} ]`;a.value=a.value.replace(`D${e}`,t)}));await Promise.all(t)}(m||v||h)&&(e="chat-roll");const b=new u(s,c,e,a.value,d,t);i.send(b.stringify()),a.value=""}const v=(0,n.e$)(e("#login-element").dataset.id),h=e("#msg-input"),b=t("fieldset[data-name]"),y=t("main form");let f=t("[data-role=opponent-wrapper]"),g=t("[data-name=score-tester] form");const $=e("[data-name=simple-roll] form"),w=e("[data-name=round-counter] form"),_=e("[data-name=widget-reaction] form"),S=e("[data-name=widget-damage-location] form"),E=e("[data-name=wound-effect] form"),k=e("[data-name=widget-criticals] form"),q=e("[data-name=widget-burst] form"),L=e("#general-state-widget"),I=e(["[data-name=fright-check] form"]),N=e(["[data-name=explosion-widget] form"]),x=e("#object-damages-widget"),M=e("#vehicle-collision-widget"),j=e("[data-name=npc-generator] form"),D=e("[data-name=wild-generator] form"),O=S.querySelector("[data-type=strength]"),F=S.querySelector("[data-type=weapon-code]"),P=S.querySelector("[data-type=hands]"),R=S.querySelector("[data-type=dice-code]"),T=E.querySelector("[data-type=dmg-type]"),C=E.querySelector("[data-type=bullet-type]"),J=e("[data-type=object-damages-object-type]"),H=e("[data-type=object-damages-localisation-options]");y.forEach((e=>{e.addEventListener("submit",(e=>e.preventDefault()))})),f.forEach((e=>{(e=new p(e)).setReactivity()})),t("[data-role=set-opponent-number]").forEach((e=>{e.addEventListener("click",(()=>{1===parseInt(e.value)?p.mountNewOpponent(f):f.length>1&&p.unmountLastOpponent(f),f=t("[data-role=opponent-wrapper]")}))}));const B=i("opponent");if(B>1){const t=e("[data-role=set-opponent-number][value='1']");for(let e=0;e<parseInt(B)-1;e++)t.click()}g.forEach((e=>d(e,h,m))),t("[data-role=set-score-number]").forEach((e=>{e.addEventListener("click",(()=>{1===(0,n.e$)(e.value)?function(e,t,a){const r=e[e.length-1],o=(0,n.e$)(r.querySelector("[data-skill-number]").dataset.skillNumber),s=r.cloneNode(!0);s.nameInput=s.querySelector("[data-skill-number]"),s.scoreInput=s.querySelector("[data-type=score]"),s.nameInput.dataset.skillNumber=o+1,s.nameInput.value="",s.scoreInput.value="",r.parentElement.appendChild(s),s.addEventListener("submit",(e=>e.preventDefault())),d(s,t,a)}(g,h,m):g.length>1&&function(e){const t=e[e.length-1],a=(0,n.e$)(t.querySelector("[data-skill-number]").dataset.skillNumber);t.remove(),localStorage.removeItem(`skill-${a}`)}(g),g=t("[data-name=score-tester] form")}))}));const K=i("skill");if(K>3){const t=e("[data-role=set-score-number][value='1']");for(let e=0;e<K-3;e++)t.click()}e("[data-role=sort-scores]").addEventListener("click",(()=>{const e=[];g.forEach((t=>{const a=t.querySelector("[data-type=skill-name]"),n=t.querySelector("[data-type=score]"),r=t.querySelector("[data-type=modif]"),o=[a.value,n.value,r.value];""!==o[0]&&e.push(o),e.sort(((e,t)=>e[0].localeCompare(t[0],"fr"))),a.value="",n.value="",r.value="",t.dispatchEvent(new Event("keyup"))})),e.forEach(((e,t)=>{g[t].querySelector("[data-type=skill-name]").value=e[0],g[t].querySelector("[data-type=score]").value=e[1],g[t].querySelector("[data-type=modif]").value=e[2],g[t].dispatchEvent(new Event("keyup"))}))})),$.addEventListener("submit",(e=>{const t=r($.querySelector("[name=dice-expression]").value);h.value+=`${t.expression} â†’ ${t.result}`,m("chat-roll")})),w.addEventListener("submit",(e=>{e.preventDefault();const a=t("[data-role=opponent-wrapper]"),r=w.querySelector("[data-type=round-number]"),o=Math.max((0,n.e$)(r.value),1),s=w.querySelector("[data-type=initiative-order]");let l=s.value.match(/\d+/g);l=l||[],l=l.map(Number),l=l.filter((e=>e<=a.length&&e>=1&&Number.isInteger(e)));const c=l.map((e=>a[e-1].querySelector("[name=name]").value||`Protagoniste ${e}`));h.value+=`*Round ${o}* â€“ `,c.length?h.value+=`${c.join(", ")}`:h.value+=s.value,m("chat-message"),r.value=o+1})),_.addEventListener("submit",(async e=>{const t=(0,n.e$)(_.querySelector("[data-type=reaction-modifier]").value.trim("+")),a=r("1d").result+t;let o=new FormData;o.append("reaction-test",a);let s=await c("/api/reaction-test",o);h.value+=`Jet de rÃ©action (${a}) â†’ ${s}`,m("chat-roll")})),O.addEventListener("keyup",(async e=>{const t=await s(O.value,F.value,P.value);void 0!==t&&(R.value=t)})),F.addEventListener("keyup",(async e=>{const t=await s(O.value,F.value,P.value);void 0!==t&&(R.value=t)})),P.addEventListener("change",(async e=>{const t=await s(O.value,F.value,P.value);void 0!==t&&(R.value=t)})),S.addEventListener("submit",(async e=>{const t=r(R.value),a=await o();E.querySelector("[data-type=raw-dmg]").value=t.result,E.querySelector("[data-type=localisation]").value=a[1],h.value+=`DÃ©gÃ¢ts (${t.expression})&nbsp;: ${t.result} â€“ ${a[0]}`,m("chat-roll")})),k.addEventListener("submit",(async e=>{const t=k.querySelector("[data-type=critical-categories]").value;let a=new FormData;a.append("table",t),a.append("roll-3d",r("3d").result),a.append("roll-1d",r("1d").result);const n=await c("/api/critical-tables",a);h.value+=`${n}`,m("chat-roll")})),q.addEventListener("submit",(async e=>{const t=q.querySelector("[data-type=rcl]").value,a=q.querySelector("[data-type=fired-bullets]").value,n=q.querySelector("[data-type=mr]").value,s=q.querySelector("[data-type=damage-dices]").value;let l=new FormData;l.append("rcl",t),l.append("bullets",a),l.append("mr",n);const c=await fetch("/api/burst-hits",{method:"post",body:l}).then((e=>e.json())).then((e=>e.data));let i=[];for(let e=0;e<c;e++){const e=r(s).result,t=await o();i.push(`${e} â€“ ${t}`)}let p=`<b>Rafale&nbsp;:</b> Rcl ${t} â€“ Balles ${a} â€“ MR ${n}`;i.forEach(((e,t)=>{p+=`<br><b>${t+1}.</b> ${e}`})),h.value+=p,m("chat-roll")})),L.addEventListener("submit",(async e=>{const t=L.querySelector("[name=opponent-selector]").value,a=new p(f[t-1]),n=new FormData;n.append("san",a.san.value),n.append("pdvm",a.pdvm.value),n.append("pdv",a.pdv.value),n.append("pain-resistance",a["pain-resistance"].value),n.append("members",a.members.value);const r=await c("/api/general-state",n);let o=`Ã‰tat gÃ©nÃ©ral de <b>${a.name.value||"Protagoniste "+a.number}</b><br>${r.general}`;if(void 0!==r.members)for(const[e,t]of Object.entries(r.members))o+=`<br>${e}&nbsp;: ${t}`;r["members-error"]&&(o+="<br>Membres&nbsp;: donnÃ©es incohÃ©rentes"),h.value+=o,m("chat-roll")})),E.addEventListener("submit",(async e=>{const t=E.querySelector("[name=opponent-selector]").value,a=new p(f[t-1]),n=r(E.querySelector("[data-type=raw-dmg]").value).result,o=E.querySelector("[data-type=rd]").value,s=E.querySelector("[data-type=dmg-type]").value,l=E.querySelector("[data-type=bullet-type]").value,i=E.querySelector("[data-type=localisation]").value,d=[];for(let e=0;e<7;e++)d.push(r("3d").result);const u=new FormData;u.append("category",a.category.value),u.append("dex",a.dex.value),u.append("san",a.san.value),u.append("pdvm",a.pdvm.value),u.append("pdv",a.pdv.value),u.append("pain-resistance",a["pain-resistance"].value),u.append("raw-dmg",n||0),u.append("rd",o||0),u.append("dmg-type",s),u.append("bullet-type",l),u.append("localisation",i),u.append("rolls",d);const v=await c("/api/wound-effects",u);if(v.erreur)return h.value+="Data opposants manquantes",void m("chat-roll");let b=`<b>${a.name.value||"Protagoniste "+a.number} â€“ ${v["dÃ©gÃ¢ts bruts"]} ( ${v["type dÃ©gÃ¢ts"]} ${v.localisation})</b>`,y=!0;b+=`<br>DÃ©gÃ¢ts effectifs&nbsp;: ${v["dÃ©gÃ¢ts effectifs"]}`,v.recul&&(b+=`<br>Recul de ${v.recul}&nbsp;m.`),v.mort&&(b+=`<br>${v.mort}`,y=!1),y&&(v["autres effets"]&&(b+=`<br>${v["autres effets"]}`),v["sonnÃ©"]&&!v["perte de conscience"]&&(b+=`<br>${v["sonnÃ©"]}`),v["perte de conscience"]&&(b+="<br>Le personnage perd conscience."),v.chute&&!v["perte de conscience"]&&(b+="<br>Le personnage chÃ»te."),v["dÃ©gÃ¢ts membre"]&&(b+=`<br>${v["dÃ©gÃ¢ts membre"]}`,""!==v["Ã©tat membre"]&&(b+=` (${v["Ã©tat membre"]})`))),h.value+=b,m("chat-roll"),a.pdv.value=v.pdv})),T.addEventListener("change",(e=>{["b0","b1","b2","b3"].includes(T.value)?C.disabled=!1:(C.value="std",C.disabled=!0)})),I.addEventListener("submit",(async e=>{const t=I.querySelector(["[data-type=fright-level]"]).value,a=(0,n.e$)(I.querySelector(["[data-type=sf-score]"]).value),o=(0,n.e$)(I.querySelector(["[data-type=sf-modif]"]).value),s=(0,n.e$)(I.querySelector(["[data-type=san-score]"]).value),i=a+o;if(a<=0||s<=0&&t>=5)return void e.preventDefault();const p=new FormData,d=l(i,r("3d").result),u=[];for(let e=0;e<=6;e++)u.push(r("3d").result);p.append("fright-level",t),p.append("sf-score",a),p.append("san-score",s),p.append("frightcheck-MR",d.MR),p.append("frightcheck-symbol",d.symbol),p.append("frightcheck-critical",d.critical),p.append("rolls",u.join(","));let v=await c("/api/fright-check",p);h.value=v,m("chat-roll",d.symbol)})),N.addEventListener("submit",(t=>{const a=e("[data-type=explosion-dmg]").value,n=e("[data-type=explosion-distance]").value,o=e("[data-type=explosion-frag-surface]").value,s=e("[data-type=explosion-frag-device]").checked,l=(r(a).result+r(a).result+r(a).result)/3*1.43,c=new FormData;c.append("damages",l),c.append("distance",n),c.append("fragmentation-surface",o),c.append("is-fragmentation-device",s),fetch("/api/explosion-damages",{method:"post",body:c}).then((e=>e.json())).then((e=>{const t=e.data,a=`<b>Explosion&nbsp;:</b> dÃ©gÃ¢ts ${t.damages} â€“ fragment(s) ${t.fragments} â€“ hauteur de chute ${t.height}&nbsp;m`;h.value+=a,m("chat-roll")}))})),J.addEventListener("change",(e=>{const t=new FormData;t.append("object-type",J.value),fetch("/api/object-localisation-options",{method:"post",body:t}).then((e=>e.json())).then((e=>{H.innerHTML="",e.data.forEach((e=>{e=e.charAt(0).toUpperCase()+e.slice(1);const t=a("option");t.innerText=e,H.appendChild(t)}))}))})),x.addEventListener("submit",(t=>{const a=e("[data-type=object-damages-pdsm]").value,n=e("[data-type=object-damages-pds]").value,o=e("[data-type=object-damages-integrite]").value,s=e("[data-type=object-damages-rd]").value,l=r(e("[data-type=object-damages-damages-code]").value).result;if(isNaN(parseInt(a))||isNaN(parseInt(o))||isNaN(parseInt(l)))return;const c=new FormData;c.append("pdsm",a),c.append("pds",n),c.append("integrite",o),c.append("rd",s),c.append("dmgValue",l),c.append("dmgType",e("[data-type=object-damages-damages-type]").value),c.append("objectType",J.value),c.append("localisation",H.value),c.append("rolls",[r("3d").result,r("3d").result,r("3d").result,r("3d").result]),fetch("/api/object-damages-effects",{method:"post",body:c}).then((e=>e.json())).then((t=>{const a=t.data;console.log(a),e("[data-type=object-damages-pds]").value=a.pds;let n=`\n\t\t\t\t<b>DÃ©gÃ¢ts ${a.objectType}</b><br>\n\t\t\t\tPdSm&nbsp;: ${a.pdsm} â€“ RD&nbsp;: ${a.rd}<br>\n\t\t\t\tDÃ©gÃ¢ts&nbsp;: ${a.netDamages} (${a.damagesLevel})<br>\n\t\t\t\tPdS restant&nbsp;: ${a.pds} (${a.stateLevel})\n\t\t\t`;if(a.sideEffects.length){n+="<br>";for(let e of a.sideEffects)n+=`â€¢&nbsp;${e[0]} niv. ${e[1]}<br>`}h.value+=n,m("chat-roll")}))})),M.addEventListener("submit",(t=>{const a=parseInt(e("[data-type=vehicle-collision-pdsm]").value),n=e("[data-type=vehicle-collision-severity]"),o=parseInt(n.value),s=n.options[n.selectedIndex].innerText;if(!a)return;let l;switch(o){case 1:l=Math.round((15+r("3d").result)/100*a);break;case 2:l=Math.round((40+r("3d").result)/100*a);break;case 3:l=Math.round((90+r("3d").result)/100*a);break;case 4:l=Math.round((180+r("6d").result)/100*a);break;case 5:l="vÃ©hicule dÃ©truit";break;default:l=0}const c=`<b>Collision</b> ${s}&nbsp;: dÃ©gÃ¢ts ${l}`;h.value+=c,m("chat-roll")}));const z=j.querySelector("[name=region]");null!==localStorage.getItem("npc-region")&&(z.value=localStorage.getItem("npc-region")),j.addEventListener("change",(()=>{localStorage.setItem("npc-region",z.value)})),j.addEventListener("submit",(async e=>{const t=new FormData(j);let a=await c("/api/npc-generator",t);if(h.value=`/${v} `,a.error)return h.value+="ParamÃ¨tres PNJ invalides",void m("chat-roll");if(a["name-only"])return h.value+=a.name,void m("chat-roll");const n=a.facialHair?`${a.facialHair},`:"",r="moyenne"!==a.corpulence?`${a.corpulence}, `:"",o="moyenne"!==a.size?`${a.size}, `:"",s="moyenne"!==a.beauty?`${a.beauty}, `:"",l="moyenne"!==a.intelligence?`${a.intelligence}, `:"",i=a.specialTraits?`<br>Choisir une particularitÃ© parmi&nbsp;: <i>${a.specialTraits}</i>`:"";h.value+=`\n\t\t<b>${a.name}</b><br>\n\t\t${a.hair},\n\t\t${n}\n\t\tyeux ${a.eyes},\n\t\t${r}\n\t\t${o}\n\t\t${s}\n\t\t${l}\n\t\t${a.social}\n\t\t${i}\n\t`,m("chat-roll")})),D.addEventListener("submit",(async e=>{const t=new FormData(D);let a=await c("/api/wild-generator",t);h.value=`/${v} `,h.value+=`\n\t\t${a}\n\t`,m("chat-roll")}));const A=e("[data-role=widget-choices]"),U=e("[data-role=widget-choices] template"),V=JSON.parse(localStorage.getItem("display-widgets"))||{"simple-roll":!0,"score-tester":!0,"widget-damage-location":!0,"widget-criticals":!0};function W(){b.forEach((e=>e.hidden=!V[e.dataset.name]))}b.forEach((e=>{const t=U.content.cloneNode(!0),a=t.querySelector("input");a.dataset.name=e.dataset.name,V[e.dataset.name]&&(a.checked=!0),a.addEventListener("change",(e=>{V[a.dataset.name]=a.checked,localStorage.setItem("display-widgets",JSON.stringify(V)),W()})),t.querySelector("span").innerHTML=e.querySelector("legend").childNodes[0].textContent.trim(),A.appendChild(t)})),W()})()})();