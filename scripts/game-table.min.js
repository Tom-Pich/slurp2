(()=>{"use strict";var __webpack_modules__={771:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function qs(e){return document.querySelector(e)}function qsa(e){return document.querySelectorAll(e)}function ce(e,t=[]){let a=document.createElement(e);return t&&t.forEach((e=>{a.classList.add(e)})),a}function checkPasswordStrength(e){const t=/\d+/.test(e),a=e.length>=8,s=/\W+/.test(e),n=/\s+/.test(e),r=/[A-Z]/.test(e),o=/[a-z]/.test(e);return t&&a&&s&&!n&&r&&o}function calculate(str){if(null===str)return"";let result;str=str.replace(/[+-]+$/g,""),str=str.replace(/[^-\(\)\d/\*+\.]/g,"");try{result=eval(str)}catch(e){result=""}return result=void 0===result?"":result,result}function int(e){return isNaN(parseInt(e))?0:parseInt(e)}function coarseRound(e){let t=!1;return e<0&&(e*=-1,t=!0),e=e<50?Math.round(e):e<200?5*Math.round(e/5):e<500?10*Math.round(e/10):e<2e3?50*Math.round(e/50):100*Math.round(e/100),t&&(e*=-1),e}__webpack_require__.d(__webpack_exports__,{Kf:()=>calculate,ce:()=>ce,e$:()=>int,qs:()=>qs,uJ:()=>qsa})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](a,a.exports,__webpack_require__),a.exports}__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{var e=__webpack_require__(771);const t="site-jdr"===window.location.hostname?"ws://127.0.0.1:1337":"wss://web-chat.pichegru.net:443";class a{constructor(e,t,a,s,n=[]){this.sender=parseInt(e),this.key=t,this.type=a,this.timestamp=Date.now(),this.content=s,this.recipients=n}stringify(){return JSON.stringify(this)}}function s(e){let t,a,s,n,r=0,o=/^(\d+)d(\d{0,3})([+-/*]*)([0-9\.]+)*/.exec(e);if(null===o)r=isNaN(parseInt(e))?0:parseInt(e),t=0,a="",s="+",n=r;else if(t=parseInt(o[1]),a=""!=o[2]?parseInt(o[2]):6,s=""!=o[3]?o[3]:"+",n=null!=o[4]&&""!=o[4]?parseFloat(o[4]):0,1===t&&6===a&&"-"===s&&2===n)r=Math.floor(5*Math.random());else if(1===t&&6===a&&"-"===s&&3===n)r=Math.floor(4*Math.random());else if(1===t&&6===a&&"-"===s&&4===n)r=Math.floor(3*Math.random());else if(1===t&&6===a&&"-"===s&&5===n)r=Math.floor(2*Math.random());else{for(let e=0;e<t;e++)r+=Math.floor(Math.random()*a)+1;switch(s){case"+":r+=n;break;case"-":r-=n;break;case"*":r*=n;break;case"/":r/=n}}let l=`${t}d${6===a?"":a}${s}${n}`;return l=l.replace("+0",""),l=l.replace("-0",""),{expression:l,result:r}}async function n(){let e=new FormData;return e.append("roll",s("3d").result),await fetch("/api/localisation-table",{method:"post",body:e}).then((e=>e.json())).then((e=>e.data))}function r(t){const a=(0,e.qs)(`[data-opponent="${t}"]`);return{name:a.querySelector("[data-type=name]").value||`Protagoniste ${t}`,dex:a.querySelector("[data-type=dex]").value||0,san:a.querySelector("[data-type=san]").value||0,pdvm:a.querySelector("[data-type=pdvm]").value||0,pdv:a.querySelector("[data-type=pdv]").value||a.querySelector("[data-type=pdvm]").value,painResistance:a.querySelector("[data-type=pain-resistance]").value,members:a.querySelector("[data-type=members]").value}}function o(e,t){const a=e-t;let s=0;18===t?s=-1:17===t?s=e>=16?0:-1:4===t?s=e<=5?0:1:3===t?s=1:a<=-10?s=-1:a>=10&&t<=7&&(s=1);let n=a>=0?"ðŸŸ¢":"ðŸ”´";return-1===s&&(n="ðŸ˜–"),1===s&&(n="ðŸ˜Ž"),{MR:a,symbol:n}}const l=(0,e.qs)("#chat-input-wrapper"),d=parseInt(l.dataset.id),p=l.dataset.login,c=l.dataset.key,i=(0,e.qs)("#connected-users"),u=(0,e.qs)("#chat-dialog-wrapper"),m=(0,e.uJ)("[data-role=emoji-button]"),v=(0,e.qs)("#msg-input"),y=new WebSocket(t);let h={},b=0,g=0,f="[]";function _(e){const t=/^\/(\d+,){0,10}\d+/.exec(v.value);let n=[];t&&(n=t[0].substring(1).split(","),n=n.map((e=>parseInt(e))),v.value=v.value.replace(t[0],"").trim());const r=v.value.match(/\[\d{1,2}\]/g);if(r){const t=[];r.forEach((e=>{t.push(parseInt(e.replace("[","").replace("]","")))})),t.forEach((e=>{const t=s("3d").result,a=o(e,t),n=`[ ${e} â†’ ${t} (MR ${a.MR} ${a.symbol}) ]`,r=new RegExp(`\\[${e}\\]`);v.value=v.value.replace(r,n)})),e="chat-roll"}let l=new a(d,c,e,v.value,n);y.send(l.stringify()),v.value=""}y.onopen=()=>{let e=new a(d,c,"chat-init",p);y.send(e.stringify())},y.onmessage=t=>{const a=JSON.parse(t.data);if(console.log(a),"chat-users"===a.type){h=a.content;const e=[];Object.entries(h).forEach((([t,a])=>{a.isConnected&&e.push(`${a.login} (${t})`)})),i.innerText=e.join(", "),void 0===a.isDeconnection&&new Audio("/assets/notifs/user-log.mp3").play()}if("chat-message"===a.type||"chat-roll"===a.type){const t=JSON.stringify(a.recipients),s=(0,e.ce)("div",["chat-message-wrapper"]),n=(0,e.ce)("div",["chat-message-header"]),r=(0,e.ce)("div",["chat-message-content"]);if("chat-roll"===a.type&&r.classList.add("color1"),a.sender===d&&s.classList.add("self-message"),a.sender!==d&&s.classList.add("bg-color-user-"+(a.sender%7+1)),a.sender===b&&t===f&&a.timestamp-g<15e3&&s.classList.add("same-routing"),a.recipients.length>0&&s.classList.add("is-private"),a.sender!==d&&(n.innerText=h[a.sender].login),a.recipients.length){const e=[];a.recipients.forEach((t=>{const a=void 0===h[t]?"?":h[t].login;e.push(a)})),n.innerText+=` (Ã  ${e.join(", ")})`}const o=new Date(a.timestamp).toLocaleTimeString("fr-FR");n.innerText+=` ${o}`,r.innerHTML=a.content,s.append(n,r),u.append(s),"chat-roll"===a.type&&void 0===a.history&&new Audio("/assets/notifs/dice-roll.mp3").play(),"chat-message"===a.type&&a.sender!==d&&void 0===a.history&&(a.recipients.length?new Audio("/assets/notifs/secret.mp3"):new Audio("/assets/notifs/message.mp3")).play(),u.scrollHeight-(u.offsetHeight+u.scrollTop)<250&&setTimeout((()=>{u.scrollTop=u.scrollHeight-u.offsetHeight+5}),200),b=a.sender,g=a.timestamp,f=t}},v.addEventListener("keydown",(function(e){13===e.keyCode&&(e.preventDefault(),_("chat-message"))})),m.forEach((e=>{e.addEventListener("click",(e=>{v.value+=e.target.innerText,v.focus()}))})),(0,e.uJ)("#widgets-container form").forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()}))}));const q=(0,e.qs)("#simple-dice-widget");q.addEventListener("submit",(e=>{let t=s(q.querySelector("[data-type=dice-expression]").value);v.value+=`${t.expression} â†’ ${t.result}`,_("chat-roll")})),(0,e.uJ)("[data-role=score-tester]").forEach((t=>{const a=t.querySelector("[data-type=skill-name]"),n=a.dataset.skillNumber,r=t.querySelector("[data-type=score]");a.value=localStorage.getItem(`skill-${n}-name`),r.value=localStorage.getItem(`skill-${n}-score`),t.addEventListener("keyup",(e=>{localStorage.setItem(`skill-${n}-name`,a.value),""===a.value&&(r.value=""),localStorage.setItem(`skill-${n}-score`,r.value)})),t.addEventListener("submit",(n=>{const l=a.value,d=parseInt(r.value);if(isNaN(d)||""===l)return;let p=parseInt(t.querySelector("[data-type=modif]").value);p=(0,e.e$)(p);const c=d+p,i=s("3d").result,u=o(c,i);v.value+=`${l} (${c}) â†’ ${i} (MR ${u.MR} ${u.symbol})`,_("chat-roll")}))}));const $=(0,e.qs)("#weapon-damage-widget"),w=(0,e.qs)("#wound-effect-widget"),S=$.querySelector("[data-type=strength]"),k=$.querySelector("[data-type=weapon-code]"),E=$.querySelector("[data-type=hands]"),x=$.querySelector("[data-type=dice-code]");function I(e,t,a){if(parseInt(e)&&t){let s="B."+t,n=new FormData;n.append("for",e),n.append("notes",s),n.append("mains",a),fetch("/api/weapon-damages",{method:"post",body:n}).then((e=>e.json())).then((e=>e.data.damages.slice(2))).then((e=>x.value=e))}}[S,k].forEach((e=>{e.addEventListener("keyup",(e=>{I(S.value,k.value,E.value)}))})),E.addEventListener("change",(e=>{I(S.value,k.value,E.value)})),$.addEventListener("submit",(async e=>{const t=s(x.value),a=await n();w.querySelector("[data-type=raw-dmg]").value=t.result,w.querySelector("[data-type=localisation]").value=a[1],v.value+=`DÃ©gÃ¢ts (${t.expression})&nbsp;: ${t.result} â€“ ${a[0]}`,_("chat-roll")}));const L=(0,e.qs)("#critical-widget");L.addEventListener("submit",(e=>{const t=L.querySelector("[data-type=critical-categories]").value;let a=new FormData;a.append("table",t),a.append("roll-3d",s("3d").result),a.append("roll-1d",s("1d").result),fetch("/api/critical-tables",{method:"post",body:a}).then((e=>e.json())).then((e=>e.data)).then((e=>{v.value+=`${e}`,_("chat-roll")}))}));const j=(0,e.qs)("#burst-widget");j.addEventListener("submit",(async e=>{const t=j.querySelector("[data-type=rcl]").value,a=j.querySelector("[data-type=fired-bullets]").value,r=j.querySelector("[data-type=mr]").value,o=j.querySelector("[data-type=damage-dices]").value;let l=new FormData;l.append("rcl",t),l.append("bullets",a),l.append("mr",r);const d=await fetch("/api/burst-hits",{method:"post",body:l}).then((e=>e.json())).then((e=>e.data));let p=[];for(let e=0;e<d;e++){const e=s(o).result,t=await n();p.push(`${e} â€“ ${t}`)}let c=`<b>Rafale&nbsp;:</b> Rcl ${t} â€“ Balles ${a} â€“ MR ${r}`;p.forEach(((e,t)=>{c+=`<br><b>${t+1}.</b> ${e}`})),v.value+=c,_("chat-roll")}));const M=(0,e.uJ)("[data-role=opponent-wrapper]"),D=(0,e.uJ)("[data-type=name-selector]");M.forEach((t=>{const a=t.dataset.opponent,s=t.querySelector("[data-type=name]"),n=t.querySelector("[data-type=dex]"),r=t.querySelector("[data-type=san]"),o=t.querySelector("[data-type=pain-resistance]"),l=t.querySelector("[data-type=pdvm]"),d=t.querySelector("[data-type=pdv]"),p=t.querySelector("[data-type=members]");s.value=localStorage.getItem(`opponent-${a}-name`),n.value=localStorage.getItem(`opponent-${a}-dex`),r.value=localStorage.getItem(`opponent-${a}-san`),o.value=localStorage.getItem(`opponent-${a}-pain-resistance`),l.value=localStorage.getItem(`opponent-${a}-pdvm`),d.value=localStorage.getItem(`opponent-${a}-pdv`),p.value=localStorage.getItem(`opponent-${a}-members`),t.addEventListener("keyup",(e=>{"name"===e.target.dataset.type&&""===e.target.value&&["name","dex","san","pain-resistance","pdvm","pdv","members"].forEach((e=>{t.querySelector(`[data-type=${e}]`).value="",localStorage.removeItem(`opponent-${a}-${e}`)}));const s=e.target.dataset.type,n="checkbox"===e.target.type?e.target.checked:e.target.value;localStorage.setItem(`opponent-${a}-${s}`,n)})),s.addEventListener("keyup",(e=>{D.forEach((e=>{e.options[a-1].innerText=""!==s.value?s.value:`Protagoniste ${a}`}))})),s.dispatchEvent(new Event("keyup")),l.addEventListener("blur",(e=>{""===d.value&&(d.value=l.value)})),d.addEventListener("blur",(t=>{d.value=(0,e.Kf)(d.value)}))}));const T=(0,e.qs)("#general-state-widget");T.addEventListener("submit",(e=>{const t=r(T.querySelector("[data-type=name-selector]").value),a=new FormData;a.append("san",t.san),a.append("pdvm",t.pdvm),a.append("pdv",t.pdv),a.append("pain-resistance",t.painResistance),a.append("members",t.members),fetch("/api/general-state",{method:"post",body:a}).then((e=>e.json())).then((e=>{let a=`\n\t\t\t\tÃ‰tat gÃ©nÃ©ral de <b>${t.name}</b><br>\n\t\t\t\t${e.data.general}\n\t\t\t`;if(void 0!==e.data.members)for(const[t,s]of Object.entries(e.data.members))a+=`<br>${t}&nbsp;: ${s}`;v.value+=a,_("chat-roll")}))})),w.addEventListener("submit",(t=>{const a=w.querySelector("[data-type=name-selector]").value,n=r(a),o=s(w.querySelector("[data-type=raw-dmg]").value).result,l=w.querySelector("[data-type=rd]").value,d=w.querySelector("[data-type=dmg-type]").value,p=w.querySelector("[data-type=bullet-type]").value,c=w.querySelector("[data-type=localisation]").value,i=[];for(let e=0;e<7;e++)i.push(s("3d").result);if(parseInt(n.dex)<0||parseInt(n.san)<0||parseInt(n.pdvm)<=0)return;const u=new FormData;u.append("dex",n.dex),u.append("san",n.san),u.append("pdvm",n.pdvm),u.append("pdv",n.pdv),u.append("pain-resistance",n.painResistance),u.append("raw-dmg",o||0),u.append("rd",l||0),u.append("dmg-type",d),u.append("bullet-type",p),u.append("localisation",c),u.append("rolls",i),fetch("/api/wound-effects",{method:"post",body:u}).then((e=>e.json())).then((t=>{const s=t.data;if(s.pdvm<=0)throw new Error("Il manque des donnÃ©es.");let r=`<b>${n.name} â€“ ${s["dÃ©gÃ¢ts bruts"]} ( ${s["type dÃ©gÃ¢ts"]} ${s.localisation})</b>`,o=!0;r+=`<br>DÃ©gÃ¢ts effectifs&nbsp;: ${s["dÃ©gÃ¢ts effectifs"]}`,s.mort&&(r+=`<br>${s.mort}`,o=!1),s["autres effets"]&&(r+=`<br>${s["autres effets"]}`),o&&(s["sonnÃ©"]&&!s["perte de conscience"]&&(r+=`<br>${s["sonnÃ©"]}`),s["perte de conscience"]&&(r+="<br>Le personnage perd conscience."),s.chute&&!s["perte de conscience"]&&(r+="<br>Le personnage chÃ»te."),s["dÃ©gÃ¢ts membre"]&&(r+=`<br>${s["dÃ©gÃ¢ts membre"]}`)),v.value+=r,_("chat-roll"),(0,e.qs)(`[data-opponent="${a}"]`).querySelector("[data-type=pdv]").value=s.pdv}))}));const N=w.querySelector("[data-type=dmg-type]"),R=w.querySelector("[data-type=bullet-type]");N.addEventListener("change",(e=>{["b0","b1","b2","b3"].includes(N.value)?R.disabled=!1:(R.value="std",R.disabled=!0)})),(0,e.qs)("#explosion-widget").addEventListener("submit",(t=>{const a=(0,e.qs)("[data-type=explosion-dmg]").value,n=(0,e.qs)("[data-type=explosion-distance]").value,r=(0,e.qs)("[data-type=explosion-frag-surface]").value,o=(0,e.qs)("[data-type=explosion-frag-device]").checked,l=(s(a).result+s(a).result+s(a).result)/3*1.43,d=new FormData;d.append("damages",l),d.append("distance",n),d.append("fragmentation-surface",r),d.append("is-fragmentation-device",o),fetch("/api/explosion-damages",{method:"post",body:d}).then((e=>e.json())).then((e=>{const t=e.data,a=`<b>Explosion&nbsp;:</b> dÃ©gÃ¢ts ${t.damages} â€“ fragment(s) ${t.fragments} â€“ hauteur de chute ${t.height}&nbsp;m`;v.value+=a,_("chat-roll")}))}));const F=(0,e.qs)("[data-type=object-damages-object-type]"),J=(0,e.qs)("[data-type=object-damages-localisation-options]");F.addEventListener("change",(t=>{const a=new FormData;a.append("object-type",F.value),fetch("/api/object-localisation-options",{method:"post",body:a}).then((e=>e.json())).then((t=>{J.innerHTML="",t.data.forEach((t=>{t=t.charAt(0).toUpperCase()+t.slice(1);const a=(0,e.ce)("option");a.innerText=t,J.appendChild(a)}))}))})),(0,e.qs)("#object-damages-widget").addEventListener("submit",(t=>{const a=(0,e.qs)("[data-type=object-damages-pdsm]").value,n=(0,e.qs)("[data-type=object-damages-pds]").value,r=(0,e.qs)("[data-type=object-damages-integrite]").value,o=(0,e.qs)("[data-type=object-damages-rd]").value,l=s((0,e.qs)("[data-type=object-damages-damages-code]").value).result;if(isNaN(parseInt(a))||isNaN(parseInt(r))||isNaN(parseInt(l)))return;const d=new FormData;d.append("pdsm",a),d.append("pds",n),d.append("integrite",r),d.append("rd",o),d.append("dmgValue",l),d.append("dmgType",(0,e.qs)("[data-type=object-damages-damages-type]").value),d.append("objectType",F.value),d.append("localisation",J.value),d.append("rolls",[s("3d").result,s("3d").result,s("3d").result,s("3d").result]),fetch("/api/object-damages-effects",{method:"post",body:d}).then((e=>e.json())).then((t=>{const a=t.data;console.log(a),(0,e.qs)("[data-type=object-damages-pds]").value=a.pds;let s=`\n\t\t\t\t<b>DÃ©gÃ¢ts ${a.objectType}</b><br>\n\t\t\t\tPdSm&nbsp;: ${a.pdsm} â€“ RD&nbsp;: ${a.rd}<br>\n\t\t\t\tDÃ©gÃ¢ts&nbsp;: ${a.netDamages} (${a.damagesLevel})<br>\n\t\t\t\tPdS restant&nbsp;: ${a.pds} (${a.stateLevel})\n\t\t\t`;if(a.sideEffects.length){s+="<br>";for(let e of a.sideEffects)s+=`â€¢&nbsp;${e[0]} niv. ${e[1]}<br>`}v.value+=s,_("chat-roll")}))})),(0,e.qs)("#vehicle-collision-widget").addEventListener("submit",(t=>{const a=parseInt((0,e.qs)("[data-type=vehicle-collision-pdsm]").value),n=(0,e.qs)("[data-type=vehicle-collision-severity]"),r=parseInt(n.value),o=n.options[n.selectedIndex].innerText;if(!a)return;let l;switch(r){case 1:l=Math.round((15+s("3d").result)/100*a);break;case 2:l=Math.round((40+s("3d").result)/100*a);break;case 3:l=Math.round((90+s("3d").result)/100*a);break;case 4:l=Math.round((180+s("6d").result)/100*a);break;case 5:l="vÃ©hicule dÃ©truit";break;default:l=0}const d=`<b>Collision</b> ${o}&nbsp;: dÃ©gÃ¢ts ${l}`;v.value+=d,_("chat-roll")}))})()})();