(()=>{"use strict";var __webpack_modules__={771:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function qs(e){return document.querySelector(e)}function qsa(e){return document.querySelectorAll(e)}function ce(e,t=[]){let r=document.createElement(e);return t&&t.forEach((e=>{r.classList.add(e)})),r}function checkPasswordStrength(e){const t=/\d+/.test(e),r=e.length>=8,s=/\W+/.test(e),a=/\s+/.test(e),n=/[A-Z]/.test(e),c=/[a-z]/.test(e);return t&&r&&s&&!a&&n&&c}function calculate(str){if(null===str)return"";let result;str=str.replace(/[+-]+$/g,""),str=str.replace(/[^-\(\)\d/\*+\.]/g,"");try{result=eval(str)}catch(e){result=""}return result=void 0===result?"":result,result}function int(e){return isNaN(parseInt(e))?0:parseInt(e)}function coarseRound(e){let t=!1;return e<0&&(e*=-1,t=!0),e=e<50?Math.round(e):e<200?5*Math.round(e/5):e<500?10*Math.round(e/10):e<2e3?50*Math.round(e/50):100*Math.round(e/100),t&&(e*=-1),e}function trimModifier(e){return(e=e.replace(/\([+-]\d+\)$/g,"")).trimEnd()}function explicitSign(e){return e>0?`+${e}`:`${e}`}function getInnerText(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""}__webpack_require__.d(__webpack_exports__,{Kf:()=>calculate,ce:()=>ce,qs:()=>qs,uJ:()=>qsa})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](r,r.exports,__webpack_require__),r.exports}__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{var e=__webpack_require__(771);function t(e){let t,r,s,a,n=0,c=/^(\d+)d(\d{0,3})([+-/*]*)([0-9\.]+)*/.exec(e);if(null===c)n=isNaN(parseInt(e))?0:parseInt(e),t=0,r="",s="+",a=n;else if(t=parseInt(c[1]),r=""!=c[2]?parseInt(c[2]):6,s=""!=c[3]?c[3]:"+",a=null!=c[4]&&""!=c[4]?parseFloat(c[4]):0,1===t&&6===r&&"-"===s&&2===a)n=Math.floor(5*Math.random());else if(1===t&&6===r&&"-"===s&&3===a)n=Math.floor(4*Math.random());else if(1===t&&6===r&&"-"===s&&4===a)n=Math.floor(3*Math.random());else if(1===t&&6===r&&"-"===s&&a<=5)n=Math.floor(2*Math.random());else{for(let e=0;e<t;e++)n+=Math.floor(Math.random()*r)+1;switch(s){case"+":n+=a;break;case"-":n-=a;break;case"*":n*=a;break;case"/":n/=a}}let o=`${t}d${6===r?"":r}${s}${a}`;return o=o.replace("+0",""),o=o.replace("-0",""),{expression:o,result:n}}const r="site-jdr"===window.location.hostname?"ws://127.0.0.1:1337":"wss://web-chat.pichegru.net:443";class s{constructor(e,t,r,s,a=[],n=null){this.sender=parseInt(e),this.key=t,this.type=r,this.timestamp=Date.now(),this.content=s,this.recipients=a,this.label=n}stringify(){return JSON.stringify(this)}}const a=(0,e.qs)("#chat-input-wrapper"),n=parseInt(a.dataset.id),c=a.dataset.login,o=a.dataset.key,l=(0,e.qs)("#connected-users"),i=(0,e.qs)("#chat-dialog-wrapper"),u=(0,e.uJ)("[data-role=emoji-button]"),d=(0,e.qs)("#msg-input"),p="1"===(0,e.qs)("#chat-container").dataset.sound,_=new WebSocket(r);window.chat={ws:_,id:n,key:o,inputEntry:d};let h={},f=0,m=0,w="[]";_.onopen=()=>{let e=new s(n,o,"chat-init",c);_.send(e.stringify())},_.onmessage=t=>{const r=JSON.parse(t.data);if("chat-users"===r.type){h=r.content;const e=[];Object.entries(h).forEach((([t,r])=>{r.isConnected&&e.push(`${r.login} (${t})`)})),l.innerText=e.join(", "),void 0===r.isDeconnection&&p&&new Audio("/assets/notifs/user-log.mp3").play()}if("chat-message"===r.type||"chat-roll"===r.type){const t=JSON.stringify(r.recipients),s=(0,e.ce)("div",["chat-message-wrapper"]),a=(0,e.ce)("div",["chat-message-header"]),c=(0,e.ce)("div",["chat-message-content"]);if("chat-roll"===r.type&&c.classList.add("chat-roll"),r.sender===n&&s.classList.add("self-message"),r.sender!==n&&s.classList.add("bg-color-user-"+(r.sender%7+1)),r.sender===f&&t===w&&r.timestamp-m<15e3&&s.classList.add("same-routing"),r.recipients.length>0&&s.classList.add("is-private"),r.sender!==n&&(a.innerText=h[r.sender].login),r.recipients.length){const e=[];r.recipients.forEach((t=>{const r=void 0===h[t]?"?":h[t].login;e.push(r)})),a.innerText+=` (Ã  ${e.join(", ")})`}const o=new Date(r.timestamp).toLocaleTimeString("fr-FR");a.innerText+=` ${o}`,c.innerHTML=r.content,s.append(a,c),i.append(s);let l=null;"chat-message"===r.type&&r.sender!==n&&(l="message.mp3"),"chat-roll"===r.type&&(l="dice-roll.mp3"),"ðŸ˜Ž"===r.label&&(l="roll-critical-success.mp3"),"ðŸŸ¢"===r.label&&(l="roll-success.mp3"),"ðŸ”´"===r.label&&(l="roll-failure.mp3"),"ðŸ˜–"===r.label&&(l="roll-critical-failure.mp3"),r.recipients.length&&(l="secret.mp3"),"history"===r.label&&(l=null),null!==l&&p&&new Audio("/assets/notifs/"+l).play(),i.scrollHeight-(i.offsetHeight+i.scrollTop)<250&&setTimeout((()=>{i.scrollTop=i.scrollHeight-i.offsetHeight+5}),200),f=r.sender,m=r.timestamp,w=t}},d.addEventListener("keydown",(function(r){13!==r.keyCode||r.shiftKey?13===r.keyCode&&(d.value+="Â¬"):(r.preventDefault(),async function(r,a=null){const n=window.chat.inputEntry,c=window.chat.id,o=window.chat.key,l=window.chat.ws,i=/^\/(\d+,){0,10}\d+/.exec(n.value);let u=[];i&&(u=i[0].substring(1).split(","),u=u.map((e=>parseInt(e))),n.value=n.value.replace(i[0],"").trim());const d=n.value.match(/#\d{1,2}([+-]\d{1,2})?(?=\s|$)/g),p=n.value.match(/#(\d+)d(\d{0,3})([+-/*]*)([0-9\.]+)*/g),_=n.value.match(/D(\d+)d(\d{0,3})([+-/*]*)([0-9\.]+)*/g);if(d){const r=[];d.forEach((e=>{r.push(e.replace("#",""))})),r.forEach((s=>{const c=t("3d").result,o=function(e,t){const r=e-t;let s=0;18===t?s=-1:17===t?s=e>=16?0:-1:4===t?s=e<=5?0:1:3===t?s=1:r<=-10?s=-1:r>=10&&t<=7&&(s=1);let a=r>=0?"ðŸŸ¢":"ðŸ”´";return-1===s&&(a="ðŸ˜–"),1===s&&(a="ðŸ˜Ž"),{MR:r,symbol:a,critical:s}}((0,e.Kf)(s),c),l=`[ ${s} â†’ ${c} (MR ${o.MR} ${o.symbol}) ]`;n.value=n.value.replace(`#${s}`,l),1===r.length&&null===p&&(a=o.symbol)}))}if(p){const e=[];p.forEach((t=>{e.push(t.replace("#",""))})),e.forEach((e=>{const r=`[ ${e} â†’ ${t(e).result} ]`;n.value=n.value.replace(`#${e}`,r)}))}if(_){const e=[];_.forEach((t=>{e.push(t.replace("D",""))}));const r=e.map((async e=>{const r=`[ ${e} â†’ ${t(e).result} â€“ ${(await async function(){let e=new FormData;return e.append("roll",t("3d").result),await fetch("/api/localisation-table",{method:"post",body:e}).then((e=>e.json())).then((e=>e.data))}())[1]} ]`;n.value=n.value.replace(`D${e}`,r)}));await Promise.all(r)}(d||p||_)&&(r="chat-roll");const h=new s(c,o,r,n.value,u,a);l.send(h.stringify()),n.value=""}("chat-message"))})),u.forEach((e=>{e.addEventListener("click",(e=>{d.value+=e.target.innerText,d.focus()}))}))})()})();