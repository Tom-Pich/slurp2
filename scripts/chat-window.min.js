(()=>{"use strict";var __webpack_modules__={771:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function calculate(str){if(null===str)return"";let result;str=str.replace(/[+-]+$/g,""),str=str.replace(/[^-\(\)\d/\*+\.]/g,"");try{result=eval(str)}catch(e){result=""}return result=void 0===result?"":result,result}function int(e){return isNaN(parseInt(e))?0:parseInt(e)}function coarseRound(e){let t=!1;return e<0&&(e*=-1,t=!0),e=e<50?Math.round(e):e<200?5*Math.round(e/5):e<500?10*Math.round(e/10):e<2e3?50*Math.round(e/50):100*Math.round(e/100),t&&(e*=-1),e}function trimModifier(e){return(e=e.replace(/\([+-]\d+\)$/g,"")).trimEnd()}function explicitSign(e){return e>0?`+${e}`:`${e}`}__webpack_require__.d(__webpack_exports__,{Kf:()=>calculate})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](a,a.exports,__webpack_require__),a.exports}__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{function e(e){return document.querySelector(e)}function t(e,t=[]){const a=document.createElement(e);return t.forEach((e=>a.classList.add(e))),a}var a=__webpack_require__(771);function r(e){let t,a,r,s,n=0,c=/^(\d+)d(\d{0,3})([+-/*]*)([0-9\.]+)*/.exec(e);if(null===c)n=isNaN(parseInt(e))?0:parseInt(e),t=0,a="",r="+",s=n;else if(t=parseInt(c[1]),a=""!=c[2]?parseInt(c[2]):6,r=""!=c[3]?c[3]:"+",s=null!=c[4]&&""!=c[4]?parseFloat(c[4]):0,1===t&&6===a&&"-"===r&&2===s)n=Math.floor(5*Math.random());else if(1===t&&6===a&&"-"===r&&3===s)n=Math.floor(4*Math.random());else if(1===t&&6===a&&"-"===r&&4===s)n=Math.floor(3*Math.random());else if(1===t&&6===a&&"-"===r&&s<=5)n=Math.floor(2*Math.random());else{for(let e=0;e<t;e++)n+=Math.floor(Math.random()*a)+1;switch(r){case"+":n+=s;break;case"-":n-=s;break;case"*":n*=s;break;case"/":n/=s}}let l=`${t}d${6===a?"":a}${r}${s}`;return l=l.replace("+0",""),l=l.replace("-0",""),{expression:l,result:n}}const s="site-jdr"===window.location.hostname?"ws://127.0.0.1:1337":"wss://web-chat.pichegru.net:443";class n{constructor(e,t,a,r,s=[],n=null){this.sender=parseInt(e),this.key=t,this.type=a,this.timestamp=Date.now(),this.content=r,this.recipients=s,this.label=n}stringify(){return JSON.stringify(this)}}const c=e("#chat-input-wrapper"),l=parseInt(c.dataset.id),o=c.dataset.login,i=c.dataset.key,u=e("#connected-users"),p=e("#chat-dialog-wrapper"),d=("[data-role=emoji-button]",document.querySelectorAll("[data-role=emoji-button]"));const _=e("#msg-input"),h="1"===e("#chat-container").dataset.sound,f=new WebSocket(s);window.chat={ws:f,id:l,key:i,inputEntry:_};let m={},w=0,g=0,b="[]";f.onopen=()=>{let e=new n(l,i,"chat-init",o);f.send(e.stringify())},f.onmessage=e=>{const a=JSON.parse(e.data);if("chat-users"===a.type){m=a.content;const e=[];Object.entries(m).forEach((([t,a])=>{a.isConnected&&e.push(`${a.login} (${t})`)})),u.innerText=e.join(", "),void 0===a.isDeconnection&&h&&new Audio("/assets/notifs/user-log.mp3").play()}if("chat-message"===a.type||"chat-roll"===a.type){const e=JSON.stringify(a.recipients),r=t("div",["chat-message-wrapper"]),s=t("div",["chat-message-header"]),n=t("div",["chat-message-content"]);if("chat-roll"===a.type&&n.classList.add("chat-roll"),a.sender===l&&r.classList.add("self-message"),a.sender!==l&&r.classList.add("bg-color-user-"+(a.sender%7+1)),a.sender===w&&e===b&&a.timestamp-g<15e3&&r.classList.add("same-routing"),a.recipients.length>0&&r.classList.add("is-private"),a.sender!==l&&(s.innerText=m[a.sender].login),a.recipients.length){const e=[];a.recipients.forEach((t=>{const a=void 0===m[t]?"?":m[t].login;e.push(a)})),s.innerText+=` (Ã  ${e.join(", ")})`}const c=new Date(a.timestamp).toLocaleTimeString("fr-FR");s.innerText+=` ${c}`,n.innerHTML=a.content,r.append(s,n),p.append(r);let o=null;"chat-message"===a.type&&a.sender!==l&&(o="message.mp3"),"chat-roll"===a.type&&(o="dice-roll.mp3"),"ðŸ˜Ž"===a.label&&(o="roll-critical-success.mp3"),"ðŸŸ¢"===a.label&&(o="roll-success.mp3"),"ðŸ”´"===a.label&&(o="roll-failure.mp3"),"ðŸ˜–"===a.label&&(o="roll-critical-failure.mp3"),a.recipients.length&&(o="secret.mp3"),"history"===a.label&&(o=null),null!==o&&h&&new Audio("/assets/notifs/"+o).play(),p.scrollHeight-(p.offsetHeight+p.scrollTop)<250&&setTimeout((()=>{p.scrollTop=p.scrollHeight-p.offsetHeight+5}),200),w=a.sender,g=a.timestamp,b=e}},_.addEventListener("keydown",(function(e){13!==e.keyCode||e.shiftKey?13===e.keyCode&&(_.value+="Â¬"):(e.preventDefault(),async function(e,t=null){const s=window.chat.inputEntry,c=window.chat.id,l=window.chat.key,o=window.chat.ws,i=/^\/(\d+,){0,10}\d+/.exec(s.value);let u=[];i&&(u=i[0].substring(1).split(","),u=u.map((e=>parseInt(e))),s.value=s.value.replace(i[0],"").trim());const p=s.value.match(/#\d{1,2}([+-]\d{1,2})?(?=\s|$)/g),d=s.value.match(/#(\d+)d(\d{0,3})([+-/*]*)([0-9\.]+)*/g),_=s.value.match(/D(\d+)d(\d{0,3})([+-/*]*)([0-9\.]+)*/g);if(p){const e=[];p.forEach((t=>{e.push(t.replace("#",""))})),e.forEach((n=>{const c=r("3d").result,l=function(e,t){const a=e-t;let r=0;18===t?r=-1:17===t?r=e>=16?0:-1:4===t?r=e<=5?0:1:3===t?r=1:a<=-10?r=-1:a>=10&&t<=7&&(r=1);let s=a>=0?"ðŸŸ¢":"ðŸ”´";return-1===r&&(s="ðŸ˜–"),1===r&&(s="ðŸ˜Ž"),{MR:a,symbol:s,critical:r}}((0,a.Kf)(n),c),o=`[ ${n} â†’ ${c} (MR ${l.MR} ${l.symbol}) ]`;s.value=s.value.replace(`#${n}`,o),1===e.length&&null===d&&(t=l.symbol)}))}if(d){const e=[];d.forEach((t=>{e.push(t.replace("#",""))})),e.forEach((e=>{const t=`[ ${e} â†’ ${r(e).result} ]`;s.value=s.value.replace(`#${e}`,t)}))}if(_){const e=[];_.forEach((t=>{e.push(t.replace("D",""))}));const t=e.map((async e=>{const t=`[ ${e} â†’ ${r(e).result} â€“ ${(await async function(){let e=new FormData;return e.append("roll",r("3d").result),await fetch("/api/localisation-table",{method:"post",body:e}).then((e=>e.json())).then((e=>e.data))}())[1]} ]`;s.value=s.value.replace(`D${e}`,t)}));await Promise.all(t)}(p||d||_)&&(e="chat-roll");const h=new n(c,l,e,s.value,u,t);o.send(h.stringify()),s.value=""}("chat-message"))})),d.forEach((e=>{e.addEventListener("click",(e=>{_.value+=e.target.innerText,_.focus()}))}))})()})();