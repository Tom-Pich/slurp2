(()=>{"use strict";var __webpack_modules__={771:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function qs(e){return document.querySelector(e)}function qsa(e){return document.querySelectorAll(e)}function ce(e,t=[]){let a=document.createElement(e);return t&&t.forEach((e=>{a.classList.add(e)})),a}function checkPasswordStrength(e){const t=/\d+/.test(e),a=e.length>=8,r=/\W+/.test(e),n=/\s+/.test(e),o=/[A-Z]/.test(e),i=/[a-z]/.test(e);return t&&a&&r&&!n&&o&&i}function calculate(str){if(null===str)return"";let result;str=str.replace(/[+-]+$/g,""),str=str.replace(/[^-\(\)\d/\*+\.]/g,"");try{result=eval(str)}catch(e){result=""}return result=void 0===result?"":result,result}function int(e){return isNaN(parseInt(e))?0:parseInt(e)}function coarseRound(e){let t=!1;return e<0&&(e*=-1,t=!0),e=e<50?Math.round(e):e<200?5*Math.round(e/5):e<500?10*Math.round(e/10):e<2e3?50*Math.round(e/50):100*Math.round(e/100),t&&(e*=-1),e}__webpack_require__.d(__webpack_exports__,{Kf:()=>calculate,ce:()=>ce,e$:()=>int,qs:()=>qs,uJ:()=>qsa})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](a,a.exports,__webpack_require__),a.exports}__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{var e=__webpack_require__(771);const t="site-jdr"===window.location.hostname?"ws://127.0.0.1:1337":"wss://web-chat.pichegru.net:443";class a{constructor(e,t,a,r,n=[]){this.sender=parseInt(e),this.key=t,this.type=a,this.timestamp=Date.now(),this.content=r,this.recipients=n}stringify(){return JSON.stringify(this)}}var r,n="undefined"==typeof document?void 0:document,o=!!n&&"content"in n.createElement("template"),i=!!n&&n.createRange&&"createContextualFragment"in n.createRange();function s(e,t){var a,r,n=e.nodeName,o=t.nodeName;return n===o||(a=n.charCodeAt(0),r=o.charCodeAt(0),a<=90&&r>=97?n===o.toUpperCase():r<=90&&a>=97&&o===n.toUpperCase())}function d(e,t,a){e[a]!==t[a]&&(e[a]=t[a],e[a]?e.setAttribute(a,""):e.removeAttribute(a))}var l={OPTION:function(e,t){var a=e.parentNode;if(a){var r=a.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(a=a.parentNode)&&a.nodeName.toUpperCase()),"SELECT"!==r||a.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),a.selectedIndex=-1)}d(e,t,"selected")},INPUT:function(e,t){d(e,t,"checked"),d(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var a=t.value;e.value!==a&&(e.value=a);var r=e.firstChild;if(r){var n=r.nodeValue;if(n==a||!a&&n==e.placeholder)return;r.nodeValue=a}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var a,r,n=-1,o=0,i=e.firstChild;i;)if("OPTGROUP"===(r=i.nodeName&&i.nodeName.toUpperCase()))i=(a=i).firstChild;else{if("OPTION"===r){if(i.hasAttribute("selected")){n=o;break}o++}!(i=i.nextSibling)&&a&&(i=a.nextSibling,a=null)}e.selectedIndex=n}}};function c(){}function u(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}const p=function(e,t,a){if(a||(a={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName||"BODY"===e.nodeName){var d=t;(t=n.createElement("html")).innerHTML=d}else p=(p=t).trim(),t=o?function(e){var t=n.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(p):i?function(e){return r||(r=n.createRange()).selectNode(n.body),r.createContextualFragment(e).childNodes[0]}(p):function(e){var t=n.createElement("body");return t.innerHTML=e,t.childNodes[0]}(p);else 11===t.nodeType&&(t=t.firstElementChild);var p,f=a.getNodeKey||u,m=a.onBeforeNodeAdded||c,v=a.onNodeAdded||c,h=a.onBeforeElUpdated||c,_=a.onElUpdated||c,g=a.onBeforeNodeDiscarded||c,b=a.onNodeDiscarded||c,w=a.onBeforeElChildrenUpdated||c,y=a.skipFromChildren||c,N=a.addChild||function(e,t){return e.appendChild(t)},E=!0===a.childrenOnly,S=Object.create(null),A=[];function x(e){A.push(e)}function q(e,t){if(1===e.nodeType)for(var a=e.firstChild;a;){var r=void 0;t&&(r=f(a))?x(r):(b(a),a.firstChild&&q(a,t)),a=a.nextSibling}}function C(e,t,a){!1!==g(e)&&(t&&t.removeChild(e),b(e),q(e,a))}function T(e){v(e);for(var t=e.firstChild;t;){var a=t.nextSibling,r=f(t);if(r){var n=S[r];n&&s(t,n)?(t.parentNode.replaceChild(n,t),k(n,t)):T(t)}else T(t);t=a}}function k(e,t,a){var r=f(t);if(r&&delete S[r],!a){if(!1===h(e,t))return;if(function(e,t){var a,r,n,o,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var s=i.length-1;s>=0;s--)r=(a=i[s]).name,n=a.namespaceURI,o=a.value,n?(r=a.localName||r,e.getAttributeNS(n,r)!==o&&("xmlns"===a.prefix&&(r=a.name),e.setAttributeNS(n,r,o))):e.getAttribute(r)!==o&&e.setAttribute(r,o);for(var d=e.attributes,l=d.length-1;l>=0;l--)r=(a=d[l]).name,(n=a.namespaceURI)?(r=a.localName||r,t.hasAttributeNS(n,r)||e.removeAttributeNS(n,r)):t.hasAttribute(r)||e.removeAttribute(r)}}(e,t),_(e),!1===w(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var a,r,o,i,d,c=y(e,t),u=t.firstChild,p=e.firstChild;e:for(;u;){for(i=u.nextSibling,a=f(u);!c&&p;){if(o=p.nextSibling,u.isSameNode&&u.isSameNode(p)){u=i,p=o;continue e}r=f(p);var v=p.nodeType,h=void 0;if(v===u.nodeType&&(1===v?(a?a!==r&&((d=S[a])?o===d?h=!1:(e.insertBefore(d,p),r?x(r):C(p,e,!0),r=f(p=d)):h=!1):r&&(h=!1),(h=!1!==h&&s(p,u))&&k(p,u)):3!==v&&8!=v||(h=!0,p.nodeValue!==u.nodeValue&&(p.nodeValue=u.nodeValue))),h){u=i,p=o;continue e}r?x(r):C(p,e,!0),p=o}if(a&&(d=S[a])&&s(d,u))c||N(e,d),k(d,u);else{var _=m(u);!1!==_&&(_&&(u=_),u.actualize&&(u=u.actualize(e.ownerDocument||n)),N(e,u),T(u))}u=i,p=o}!function(e,t,a){for(;t;){var r=t.nextSibling;(a=f(t))?x(a):C(t,e,!0),t=r}}(e,p,r);var g=l[e.nodeName];g&&g(e,t)}(e,t):l.TEXTAREA(e,t)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var a=t.firstChild;a;){var r=f(a);r&&(S[r]=a),e(a),a=a.nextSibling}}(e);var I,L,O=e,M=O.nodeType,U=t.nodeType;if(!E)if(1===M)1===U?s(e,t)||(b(e),O=function(e,t){for(var a=e.firstChild;a;){var r=a.nextSibling;t.appendChild(a),a=r}return t}(e,(I=t.nodeName,(L=t.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==L?n.createElementNS(L,I):n.createElement(I)))):O=t;else if(3===M||8===M){if(U===M)return O.nodeValue!==t.nodeValue&&(O.nodeValue=t.nodeValue),O;O=t}if(O===t)b(e);else{if(t.isSameNode&&t.isSameNode(O))return;if(k(O,t,E),A)for(var D=0,P=A.length;D<P;D++){var R=S[A[D]];R&&C(R,R.parentNode,!1)}}return!E&&O!==e&&e.parentNode&&(O.actualize&&(O=O.actualize(e.ownerDocument||n)),e.parentNode.replaceChild(O,e)),O},f=(0,e.qs)("#ws-data").dataset.sessionId,m=(0,e.qs)("#ws-data").dataset.wsKey,v=parseInt((0,e.qs)("#character-name").dataset.id),h=(0,e.qs)("#form-equipment"),_=(0,e.qs)("[data-role=members-wrapper]"),g=h.querySelectorAll("input");let b=0;const w=new WebSocket(t);function y(){(0,e.uJ)("[data-role=container-wrapper]").forEach((e=>{"true"===localStorage.getItem(`container-${e.dataset.place}`)&&e.setAttribute("open",!0),e.children[0].addEventListener("click",(t=>{const a=!t.target.closest("details").hasAttribute("open");localStorage.setItem(`container-${e.dataset.place}`,a)}))}))}function N(){const t=(0,e.qs)("[name=pdm_counter]");if(t){const a=localStorage.getItem("pdm-count"),r=parseInt(t.dataset.pdmMax),n=r+(0,e.e$)((0,e.Kf)(a)),o=parseInt(t.dataset.pdmCurrent);t.value=n===o?a:o===r?"":o-r}}function E(e=!1){let t=new FormData;h.querySelectorAll("input").forEach((e=>{"checkbox"===e.type?t.append(e.name,e.checked?e.value:""):t.append(e.name,e.value)})),fetch("/submit/equipment-list",{method:"post",body:t}).then((()=>{const t=new a(f,m,"character-ping",e?0:v);w.send(t.stringify())}))}w.onopen=()=>{},w.onmessage=e=>{const t=JSON.parse(e.data);console.log(t),"character-ping"===t.type&&[0,v].includes(t.content)&&fetch("personnage-fiche?perso="+v).then((e=>e.text())).then((e=>{!function(e,t){const a=(new DOMParser).parseFromString(t,"text/html").querySelector(e),r=document.querySelector(e);p(r,a)}("main",e),y(),N()}))},y(),N(),h.addEventListener("click",(t=>{const a=t.target;if("container-up"===a.dataset.role){const e=a.closest("[data-role=container-wrapper]"),t=e.previousElementSibling;t&&(h.insertBefore(e,t),E())}else if("container-down"===a.dataset.role){const e=a.closest("[data-role=container-wrapper]"),t=e.nextElementSibling;"container-wrapper"===t.dataset.role&&(t.after(e),E())}else if("add-item"===a.dataset.role){b++;const t=a.closest("[data-role=container-wrapper]");let r=(0,e.ce)("details",["items-list"]);r.innerHTML=`\n\t\t\t<summary class="grid gap-½ ai-center">\n\t\t\t\t<div class="ff-fas" draggable="true" data-role="item-grip">&#xf58e;</div>\n\t\t\t\t<input name="nouvel-objet[${b}][Nom]"\ttype="text" placeholder = "Nouvel objet" >\n\t\t\t\t<input name="nouvel-objet[${b}][Poids]" type="text" class="ta-center">\n\t\t\t\t<input hidden name="nouvel-objet[${b}][Lieu]" value="${t.dataset.place}">\n\t\t\t</summary>\n\t\t\t<div class="italic ta-center mt-½">\n\t\t\t\tEnregistrer les modifications avant de pouvoir ajouter des notes\n\t\t\t</div>\n\t\t`,t.appendChild(r)}})),h.addEventListener("change",(e=>{E(void 0!==e.target.dataset.pingAll)}));let S=null;h.addEventListener("dragover",(e=>{e.preventDefault()})),h.addEventListener("dragstart",(e=>{"item-grip"===e.target.dataset.role&&(g.forEach((e=>{e.disabled=!0})),S=e.target.closest("[data-role=item-wrapper]"))})),h.addEventListener("dragend",(e=>{"item-grip"===e.target.dataset.role&&(g.forEach((e=>{e.disabled=!1})),E())})),h.addEventListener("dragenter",(e=>{if("item-grip"===e.target.dataset.role){let t=e.target.closest("[data-role=container-wrapper]"),a=e.target.closest("[data-role=item-wrapper]");t.insertBefore(S,a),S.querySelector("[data-role=item-place]").value=t.dataset.place}else if("free-slot"===e.target.dataset.role){let t=e.target.closest("[data-role=container-wrapper]"),a=e.target;t.insertBefore(S,a),S.querySelector("[data-role=item-place]").value=t.dataset.place}})),_.addEventListener("dragover",(e=>{e.preventDefault()})),_.addEventListener("drop",(t=>{const r=t.target.closest("[data-role=item-transfer]");if(r){const t=(0,e.qs)("#item-transfer");S.querySelector("[data-role=item-place]").value=r.dataset.place,t.append(S),setTimeout((()=>{const e=parseInt(r.dataset.place.substr(3)),t=new a(f,m,"character-ping",e);w.send(t.stringify())}),300)}})),h.addEventListener("submit",(e=>{e.preventDefault(),E()})),(0,e.uJ)("[data-role=item-notes]").forEach((t=>{t.addEventListener("mouseover",(t=>{if(""!==t.target.value){let a=new FormData;a.append("for",(0,e.qs)("#for-deg").innerText),a.append("notes",t.target.value),fetch("/api/weapon-damages",{method:"post",body:a}).then((e=>e.json())).then((e=>t.target.title=e.data.damages))}}))}));const A=(0,e.qs)("[name=pdm_counter]");if(A){let t;A.addEventListener("keyup",(r=>{t&&clearTimeout(t),t=setTimeout((()=>function(){const t=parseInt(A.dataset.pdmMax),r=A.value,n=(0,e.Kf)(A.value);let o;["+","-"].includes(r.charAt(0))||""===r||""!==n?localStorage.setItem("pdm-count",r):localStorage.setItem("pdm-count",""),o=""===r?"":t+(0,e.e$)(n);let i=new FormData;i.append("id",v),i.append("pdm",o),i.append("max",t),o<0?alert("Vous ne pouvez pas dépenser autant de PdM !"):fetch("/submit/update-character-pdm",{method:"post",body:i}).then((e=>e.text())).then((()=>{const e=new a(f,m,"character-ping",v);w.send(e.stringify())}))}()),1e3)}))}})()})();