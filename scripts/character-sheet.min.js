(()=>{"use strict";var __webpack_modules__={771:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function calculate(str){if(null===str)return"";let result;str=str.replace(/[+-]+$/g,""),str=str.replace(/[^-\(\)\d/\*+\.]/g,"");try{result=eval(str)}catch(e){result=""}return result=void 0===result?"":result,result}function int(e){return isNaN(parseInt(e))?0:parseInt(e)}function coarseRound(e){let t=!1;return e<0&&(e*=-1,t=!0),e=e<50?Math.round(e):e<200?5*Math.round(e/5):e<500?10*Math.round(e/10):e<2e3?50*Math.round(e/50):100*Math.round(e/100),t&&(e*=-1),e}function trimModifier(e){return(e=e.replace(/\([+-]\d+\)$/g,"")).trimEnd()}function explicitSign(e){return e>0?`+${e}`:`${e}`}__webpack_require__.d(__webpack_exports__,{Ie:()=>explicitSign,Kf:()=>calculate,e$:()=>int,ld:()=>trimModifier})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](a,a.exports,__webpack_require__),a.exports}__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={};(()=>{const e=e=>document.querySelector(e),t=e=>document.querySelectorAll(e);function a(e,t=[]){const a=document.createElement(e);return t.forEach((e=>a.classList.add(e))),a}var r=__webpack_require__(771);const n="site-jdr"===window.location.hostname?"ws://127.0.0.1:1337":"wss://web-chat.pichegru.net:443";class o{constructor(e,t,a,r,n=[],o=null){this.sender=parseInt(e),this.key=t,this.type=a,this.timestamp=Date.now(),this.content=r,this.recipients=n,this.label=o}stringify(){return JSON.stringify(this)}}var i,l="undefined"==typeof document?void 0:document,s=!!l&&"content"in l.createElement("template"),d=!!l&&l.createRange&&"createContextualFragment"in l.createRange();function c(e,t){var a,r,n=e.nodeName,o=t.nodeName;return n===o||(a=n.charCodeAt(0),r=o.charCodeAt(0),a<=90&&r>=97?n===o.toUpperCase():r<=90&&a>=97&&o===n.toUpperCase())}function u(e,t,a){e[a]!==t[a]&&(e[a]=t[a],e[a]?e.setAttribute(a,""):e.removeAttribute(a))}var p={OPTION:function(e,t){var a=e.parentNode;if(a){var r=a.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(a=a.parentNode)&&a.nodeName.toUpperCase()),"SELECT"!==r||a.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),a.selectedIndex=-1)}u(e,t,"selected")},INPUT:function(e,t){u(e,t,"checked"),u(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var a=t.value;e.value!==a&&(e.value=a);var r=e.firstChild;if(r){var n=r.nodeValue;if(n==a||!a&&n==e.placeholder)return;r.nodeValue=a}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var a,r,n=-1,o=0,i=e.firstChild;i;)if("OPTGROUP"===(r=i.nodeName&&i.nodeName.toUpperCase()))i=(a=i).firstChild;else{if("OPTION"===r){if(i.hasAttribute("selected")){n=o;break}o++}!(i=i.nextSibling)&&a&&(i=a.nextSibling,a=null)}e.selectedIndex=n}}};function m(){}function f(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}const h=function(e,t,a){if(a||(a={}),"string"==typeof t)if("#document"===e.nodeName||"HTML"===e.nodeName||"BODY"===e.nodeName){var r=t;(t=l.createElement("html")).innerHTML=r}else n=(n=t).trim(),t=s?function(e){var t=l.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(n):d?function(e){return i||(i=l.createRange()).selectNode(l.body),i.createContextualFragment(e).childNodes[0]}(n):function(e){var t=l.createElement("body");return t.innerHTML=e,t.childNodes[0]}(n);else 11===t.nodeType&&(t=t.firstElementChild);var n,o=a.getNodeKey||f,u=a.onBeforeNodeAdded||m,h=a.onNodeAdded||m,v=a.onBeforeElUpdated||m,g=a.onElUpdated||m,b=a.onBeforeNodeDiscarded||m,_=a.onNodeDiscarded||m,y=a.onBeforeElChildrenUpdated||m,w=a.skipFromChildren||m,S=a.addChild||function(e,t){return e.appendChild(t)},N=!0===a.childrenOnly,E=Object.create(null),T=[];function x(e){T.push(e)}function k(e,t){if(1===e.nodeType)for(var a=e.firstChild;a;){var r=void 0;t&&(r=o(a))?x(r):(_(a),a.firstChild&&k(a,t)),a=a.nextSibling}}function A(e,t,a){!1!==b(e)&&(t&&t.removeChild(e),_(e),k(e,a))}function M(e){h(e);for(var t=e.firstChild;t;){var a=t.nextSibling,r=o(t);if(r){var n=E[r];n&&c(t,n)?(t.parentNode.replaceChild(n,t),C(n,t)):M(t)}else M(t);t=a}}function C(e,t,a){var r=o(t);if(r&&delete E[r],!a){if(!1===v(e,t))return;if(function(e,t){var a,r,n,o,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var l=i.length-1;l>=0;l--)r=(a=i[l]).name,n=a.namespaceURI,o=a.value,n?(r=a.localName||r,e.getAttributeNS(n,r)!==o&&("xmlns"===a.prefix&&(r=a.name),e.setAttributeNS(n,r,o))):e.getAttribute(r)!==o&&e.setAttribute(r,o);for(var s=e.attributes,d=s.length-1;d>=0;d--)r=(a=s[d]).name,(n=a.namespaceURI)?(r=a.localName||r,t.hasAttributeNS(n,r)||e.removeAttributeNS(n,r)):t.hasAttribute(r)||e.removeAttribute(r)}}(e,t),g(e),!1===y(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var a,r,n,i,s,d=w(e,t),m=t.firstChild,f=e.firstChild;e:for(;m;){for(i=m.nextSibling,a=o(m);!d&&f;){if(n=f.nextSibling,m.isSameNode&&m.isSameNode(f)){m=i,f=n;continue e}r=o(f);var h=f.nodeType,v=void 0;if(h===m.nodeType&&(1===h?(a?a!==r&&((s=E[a])?n===s?v=!1:(e.insertBefore(s,f),r?x(r):A(f,e,!0),r=o(f=s)):v=!1):r&&(v=!1),(v=!1!==v&&c(f,m))&&C(f,m)):3!==h&&8!=h||(v=!0,f.nodeValue!==m.nodeValue&&(f.nodeValue=m.nodeValue))),v){m=i,f=n;continue e}r?x(r):A(f,e,!0),f=n}if(a&&(s=E[a])&&c(s,m))d||S(e,s),C(s,m);else{var g=u(m);!1!==g&&(g&&(m=g),m.actualize&&(m=m.actualize(e.ownerDocument||l)),S(e,m),M(m))}m=i,f=n}!function(e,t,a){for(;t;){var r=t.nextSibling;(a=o(t))?x(a):A(t,e,!0),t=r}}(e,f,r);var b=p[e.nodeName];b&&b(e,t)}(e,t):p.TEXTAREA(e,t)}!function e(t){if(1===t.nodeType||11===t.nodeType)for(var a=t.firstChild;a;){var r=o(a);r&&(E[r]=a),e(a),a=a.nextSibling}}(e);var I,q,$=e,L=$.nodeType,O=t.nodeType;if(!N)if(1===L)1===O?c(e,t)||(_(e),$=function(e,t){for(var a=e.firstChild;a;){var r=a.nextSibling;t.appendChild(a),a=r}return t}(e,(I=t.nodeName,(q=t.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==q?l.createElementNS(q,I):l.createElement(I)))):$=t;else if(3===L||8===L){if(O===L)return $.nodeValue!==t.nodeValue&&($.nodeValue=t.nodeValue),$;$=t}if($===t)_(e);else{if(t.isSameNode&&t.isSameNode($))return;if(C($,t,N),T)for(var D=0,R=T.length;D<R;D++){var U=E[T[D]];U&&A(U,U.parentNode,!1)}}return!N&&$!==e&&e.parentNode&&($.actualize&&($=$.actualize(e.ownerDocument||l)),e.parentNode.replaceChild($,e)),$};const v=e("#ws-data").dataset.sessionId,g=e("#ws-data").dataset.wsKey,b=parseInt(e("#character-name").dataset.id),_=parseInt(e("#character-name").dataset.gm),y=e("#form-equipment"),w=e("[data-role=members-wrapper]"),S=y.querySelectorAll("input");let N=0;const E=new WebSocket(n);function T(r){fetch("personnage-fiche?perso="+r).then((e=>e.text())).then((r=>{var n,o;(n="main",o=r,new Promise(((e,t)=>{try{const t=(new DOMParser).parseFromString(o,"text/html").querySelector(n),a=document.querySelector(n);h(a,t,{onBeforeElUpdated:function(e,t){if("DETAILS"===e.tagName&&e.id===t.id&&(t.open=e.open),"ignore"===e.dataset.morphdom)return!1}}),e("DOM updated successfully")}catch(e){t(e)}}))).then((()=>function(r,n){const o=a("div",["alert",`alert-${t(".alert").length+1}`]);o.innerHTML="Personnage mis à jour&nbsp;!",o.classList.add("valid");const i=e("#page-wrapper");document.body.insertBefore(o,i),setTimeout((()=>o.classList.add("active")),100),setTimeout((()=>o.classList.remove("active")),2e3),setTimeout((()=>o.remove()),2100)}())).then((()=>x())).then((()=>{e("#loading-spinner").style.display="none"}))}))}function x(){const t=e("[name=pdm_counter]");if(t){const e=localStorage.getItem(`pdm-count-${b}`),a=parseInt(t.dataset.pdmMax),n=a+(0,r.e$)((0,r.Kf)(e)),o=parseInt(t.dataset.pdmCurrent);t.value=n===o?e:o===a?"":o-a}}function k(t=!1){let a=new FormData;y.querySelectorAll("input").forEach((e=>{"checkbox"===e.type?a.append(e.name,e.checked?e.value:""):a.append(e.name,e.value)})),function(t=null){e("#loading-spinner").style.display="block",t&&(t.querySelector("[type=submit]").disabled=!0)}(),fetch("/submit/equipment-list",{method:"post",body:a}).then((()=>{const e=new o(v,g,"character-ping",t?0:b);E.send(e.stringify())}))}E.onopen=()=>{},E.onmessage=e=>{const t=JSON.parse(e.data);console.log(t),"character-ping"===t.type&&[0,b].includes(t.content)&&T(b)},t("[data-role=container-wrapper]").forEach((e=>{"true"===localStorage.getItem(`container-${e.dataset.place}`)&&e.setAttribute("open",!0),e.children[0].addEventListener("click",(t=>{const a=!t.target.closest("details").hasAttribute("open");localStorage.setItem(`container-${e.dataset.place}`,a)}))})),x(),new BroadcastChannel("display-options").onmessage=e=>{"style"===e.data.option&&T(b)},y.addEventListener("click",(e=>{const t=e.target;if("container-up"===t.dataset.role){const e=t.closest("[data-role=container-wrapper]"),a=e.previousElementSibling;a&&(y.insertBefore(e,a),k())}else if("container-down"===t.dataset.role){const e=t.closest("[data-role=container-wrapper]"),a=e.nextElementSibling;"container-wrapper"===a.dataset.role&&(a.after(e),k())}else if("add-item"===t.dataset.role){N++;const e=t.closest("[data-role=container-wrapper]"),r=e.querySelector("[data-role=free-slot]"),n=a("details",["items-list"]);n.innerHTML=`\n\t\t\t<summary class="grid gap-½ ai-center">\n\t\t\t\t<div class="ff-fas" draggable="true" data-role="item-grip">&#xf58e;</div>\n\t\t\t\t<input name="nouvel-objet[${N}][Nom]"\ttype="text" placeholder = "Nouvel objet">\n\t\t\t\t<input name="nouvel-objet[${N}][Poids]" type="text" class="ta-center">\n\t\t\t\t<input hidden name="nouvel-objet[${N}][Lieu]" value="${e.dataset.place}">\n\t\t\t\t<input hidden name="nouvel-objet[${N}][MJ]" value="${_}">\n\t\t\t</summary>\n\t\t\t<div class="italic ta-center mt-½">\n\t\t\t\tEnregistrer les modifications avant de pouvoir ajouter des notes\n\t\t\t</div>\n\t\t`,e.insertBefore(n,r)}})),y.addEventListener("change",(e=>{k(void 0!==e.target.dataset.pingAll)}));let A,M=null;y.addEventListener("dragover",(e=>{e.preventDefault()})),y.addEventListener("dragstart",(e=>{"item-grip"===e.target.dataset.role&&(S.forEach((e=>{e.disabled=!0})),M=e.target.closest("[data-role=item-wrapper]"))})),y.addEventListener("dragend",(e=>{"item-grip"===e.target.dataset.role&&(S.forEach((e=>{e.disabled=!1})),k())})),y.addEventListener("dragenter",(e=>{if("item-grip"===e.target.dataset.role){A&&clearTimeout(A);let t=e.target.closest("[data-role=container-wrapper]"),a=e.target.closest("[data-role=item-wrapper]");t.insertBefore(M,a),M.querySelector("[data-role=item-place]").value=t.dataset.place}else if("free-slot"===e.target.dataset.role){A&&clearTimeout(A);let t=e.target.closest("[data-role=container-wrapper]"),a=e.target;t.insertBefore(M,a),M.querySelector("[data-role=item-place]").value=t.dataset.place}else e.target.closest("summary")&&"container-title-wrapper"===e.target.closest("summary").dataset.role&&(A&&clearTimeout(A),A=setTimeout((function(){e.target.closest("[data-role=container-wrapper]").open=!0}),500))})),w.addEventListener("dragover",(e=>{e.preventDefault()})),w.addEventListener("drop",(t=>{const a=t.target.closest("[data-role=item-transfer]");if(a){const t=e("#item-transfer");M.querySelector("[data-role=item-place]").value=a.dataset.place,t.append(M),setTimeout((()=>{const e=parseInt(a.dataset.place.substr(3)),t=new o(v,g,"character-ping",e);E.send(t.stringify())}),300)}})),y.addEventListener("submit",(e=>{e.preventDefault(),k()})),t("[data-role=item-notes]").forEach((t=>{t.addEventListener("mouseover",(t=>{if(""!==t.target.value){let a=new FormData;a.append("for",e("#for-deg").innerText),a.append("notes",t.target.value),fetch("/api/weapon-damages",{method:"post",body:a}).then((e=>e.json())).then((e=>t.target.title=e.data.damages))}}))}));const C=e("[name=pdm_counter]");if(C){let e;C.addEventListener("keyup",(t=>{e&&clearTimeout(e),e=setTimeout((()=>function(){const e=parseInt(C.dataset.pdmMax),t=C.value,a=(0,r.Kf)(C.value);let n;["+","-"].includes(t.charAt(0))||""===t||""!==a?localStorage.setItem(`pdm-count-${b}`,t):localStorage.setItem(`pdm-count-${b}`,""),n=""===t?"":e+(0,r.e$)(a);let i=new FormData;i.append("id",b),i.append("pdm",n),i.append("max",e),n<0?alert("Vous ne pouvez pas dépenser autant de PdM !"):fetch("/submit/update-character-pdm",{method:"post",body:i}).then((e=>e.text())).then((()=>{const e=new o(v,g,"character-ping",b);E.send(e.stringify())}))}()),1e3)}))}const I=t("[data-type=throwable-label], [data-type=throwable-score]"),q=e("dialog[data-type=character-sheet-roll]"),$=q.querySelector("[data-type=send-test]"),L=q.querySelector("[data-type=test-modifier-value]");let O,D;I.forEach((e=>{e.addEventListener("click",(t=>{const a=e.closest("[data-type=throwable-wrapper]");"SUMMARY"===a.tagName&&"throwable-label"===t.target.dataset.type||(t.preventDefault(),q.showModal(),L.focus(),L.value="",O=(0,r.ld)(a.querySelector("[data-type=throwable-label]").innerText),D=a.querySelector("[data-type=throwable-score]").innerText,q.querySelector("[data-content=label]").innerText=O,q.querySelector("[data-content=score]").value=D)}))})),$.addEventListener("click",(e=>{const t=(0,r.e$)(L.value),a=0===t?"":(0,r.Ie)(t),n=parseInt(q.querySelector("[data-content=score]").value),i=function(e){let t,a,r,n,o=0,i=/^(\d+)d(\d{0,3})([+-/*]*)([0-9\.]+)*/.exec(e);if(null===i)o=isNaN(parseInt(e))?0:parseInt(e),t=0,a="",r="+",n=o;else if(t=parseInt(i[1]),a=""!=i[2]?parseInt(i[2]):6,r=""!=i[3]?i[3]:"+",n=null!=i[4]&&""!=i[4]?parseFloat(i[4]):0,1===t&&6===a&&"-"===r&&2===n)o=Math.floor(5*Math.random());else if(1===t&&6===a&&"-"===r&&3===n)o=Math.floor(4*Math.random());else if(1===t&&6===a&&"-"===r&&4===n)o=Math.floor(3*Math.random());else if(1===t&&6===a&&"-"===r&&n<=5)o=Math.floor(2*Math.random());else{for(let e=0;e<t;e++)o+=Math.floor(Math.random()*a)+1;switch(r){case"+":o+=n;break;case"-":o-=n;break;case"*":o*=n;break;case"/":o/=n}}let l=`${t}d${6===a?"":a}${r}${n}`;return l=l.replace("+0",""),l=l.replace("-0",""),{expression:l,result:o}}("3d").result,l=function(e,t){const a=e-t;let r=0;18===t?r=-1:17===t?r=e>=16?0:-1:4===t?r=e<=5?0:1:3===t?r=1:a<=-10?r=-1:a>=10&&t<=7&&(r=1);let n=a>=0?"🟢":"🔴";return-1===r&&(n="😖"),1===r&&(n="😎"),{MR:a,symbol:n,critical:r}}(n+t,i),s=`${O} (${n}${a}) → ${i} (MR ${l.MR} ${l.symbol})`,d=q.querySelector("[data-type=secret-test-checkbox]").checked,c=new o(v,g,"chat-roll",s,d?[_]:[],l.symbol);E.send(c.stringify()),q.close()})),q.addEventListener("keydown",(e=>{13===e.keyCode&&(e.preventDefault(),$.click())}))})()})();